<!DOCTYPE html><html><head><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-154810525-2" class="jsx-1038624251"></script><script type="text/javascript" class="jsx-1038624251">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-154810525-2');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-BZKS5D8HPF" class="jsx-1038624251"></script><script type="text/javascript" class="jsx-1038624251">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-BZKS5D8HPF');
        </script><meta charSet="utf-8" class="jsx-1038624251"/><meta name="viewport" content="width=device-width, initial-scale=1" class="jsx-1038624251"/><link rel="manifest" href="/site.webmanifest" class="jsx-1038624251"/><link rel="apple-touch-icon" href="/icon.png" class="jsx-1038624251"/><meta name="theme-color" content="#fff" class="jsx-1038624251"/><title>Kubernetes aliases and functions using fzf - updated | Brad Barrows&#x27; Blog</title><meta name="description" content="Brad Barrows&#x27; Blog"/><link rel="canonical" href="https://bbarrows.com/posts/kubernetes-aliases-functions"/><meta property="og:site_name" content="Brad Barrows&#x27; Blog"/><meta property="og:url" content="https://bbarrows.com/posts/kubernetes-aliases-functions"/><meta property="og:title" content="Kubernetes aliases and functions using fzf - updated | Brad Barrows&#x27; Blog"/><meta property="og:description" content="Brad Barrows&#x27; Blog"/><meta property="og:image" content="https://bbarrows.com/og_image.png"/><meta property="og:type" content="article"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":"https://bbarrows.com/posts/kubernetes-aliases-functions","headline":"Kubernetes aliases and functions using fzf - updated","datePublished":"2023-02-02T00:00:00-08:00","author":"Brad Barrows","description":""}</script><meta name="next-head-count" content="19"/><link rel="preload" href="/_next/static/css/8e11f38ccf46f6277e39.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e11f38ccf46f6277e39.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e884486185169a1848b2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e884486185169a1848b2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-f47d69457824065d04c3.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-d32200c037819e7e8fa0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-eae7af63eb651790e0a7.js" defer=""></script><script src="/_next/static/chunks/242-a90f3e6176c9397c3396.js" defer=""></script><script src="/_next/static/chunks/113-c601093cb35883d4dc66.js" defer=""></script><script src="/_next/static/chunks/295-a5a72f3288431f3121e1.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpost%5D-d3d5da1871e5e33a73d7.js" defer=""></script><script src="/_next/static/-72x7XyjKLO7T9jMRO098/_buildManifest.js" defer=""></script><script src="/_next/static/-72x7XyjKLO7T9jMRO098/_ssgManifest.js" defer=""></script><style id="__jsx-3058196896">.container.jsx-3058196896{position:fixed;width:38px;height:38px;cursor:pointer;top:1rem;left:1.25rem;z-index:2;background-color:rgba(255,255,255,0.7);}.meat.jsx-3058196896{position:absolute;width:28px;height:2px;background:#222;top:calc(50% - 2px / 2);left:calc(50% - 28px / 2);-webkit-transition:all 150ms ease-in;transition:all 150ms ease-in;}.meat-1.jsx-3058196896{-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px);transform:translateY(-10px);}.meat-2.jsx-3058196896{width:calc(28px - 6px);}.meat-3.jsx-3058196896{-webkit-transform:translateY(10px);-ms-transform:translateY(10px);transform:translateY(10px);}.active.jsx-3058196896 .meat-1.jsx-3058196896{-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);}.active.jsx-3058196896 .meat-2.jsx-3058196896{opacity:0;}.active.jsx-3058196896 .meat-3.jsx-3058196896{-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg);}@media (min-width:769px){.container.jsx-3058196896{display:none;}}</style><style id="__jsx-4138737674">.container.jsx-4138737674{width:0;}ul.jsx-4138737674{opacity:0;width:100%;height:100vh;text-align:right;list-style:none;margin:0;padding:0;position:fixed;top:0;background-color:#fff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;z-index:1;-webkit-transform:translateY(100%);-ms-transform:translateY(100%);transform:translateY(100%);-webkit-transition:opacity 200ms;transition:opacity 200ms;}.active.jsx-4138737674 ul.jsx-4138737674{opacity:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}li.jsx-4138737674{margin-bottom:1.75rem;font-size:2rem;padding:0 1.5rem 0 0;}li.jsx-4138737674:last-child{margin-bottom:0;}.active.jsx-4138737674{color:#222;}@media (min-width:769px){.container.jsx-4138737674{width:7rem;display:block;}ul.jsx-4138737674{opacity:1;width:7rem;top:auto;display:block;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}li.jsx-4138737674{font-size:1rem;padding:0;}}</style><style id="__jsx-3674465219">span.jsx-3674465219{color:#9b9b9b;}</style><style id="__jsx-255066894">a.jsx-255066894{display:inline-block;}a.jsx-255066894:not(:last-child){margin-right:2em;}</style><style id="__jsx-3618008669">p.jsx-3618008669{font-size:0.75rem;text-align:center;}</style><style id="__jsx-4153080612">.container.jsx-3387257903{display:block;max-width:60rem;width:100%;margin:0 auto;padding:0 1.5rem;box-sizing:border-box;z-index:0;}.metadata.jsx-3387257903 div.jsx-3387257903{display:inline-block;margin-right:0.5rem;}article.jsx-3387257903{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}h1.jsx-3387257903{margin:0 0 0.5rem;font-size:2.25rem;}.tag-list.jsx-3387257903{list-style:none;text-align:right;margin:1.75rem 0 0 0;padding:0;}.tag-list.jsx-3387257903 li.jsx-3387257903{display:inline-block;margin-left:0.5rem;}.social-list.jsx-3387257903{margin-top:3rem;text-align:center;}@media (min-width:769px){.container.jsx-3387257903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><style id="__jsx-1699270818">.token.comment,.token.prolog,.token.doctype,.token.cdata,.token.plain-text{color:#6a737d;}.token.atrule,.token.attr-value,.token.keyword,.token.operator{color:#d73a49;}.token.property,.token.tag,.token.boolean,.token.number,.token.constant,.token.symbol,.token.deleted{color:#22863a;}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#032f62;}.token.function,.token.class-name{color:#6f42c1;}.language-jsx .token.punctuation,.language-jsx .token.tag .token.punctuation,.language-jsx .token.tag .token.script,.language-jsx .token.plain-text{color:#24292e;}.language-jsx .token.tag .token.attr-name{color:#6f42c1;}.language-jsx .token.tag .token.class-name{color:#005cc5;}.language-jsx .token.tag .token.script-punctuation,.language-jsx .token.attr-value .token.punctuation:first-child{color:#d73a49;}.language-jsx .token.attr-value{color:#032f62;}.language-jsx span[class="comment"]{color:pink;}.language-html .token.tag .token.punctuation{color:#24292e;}.language-html .token.tag .token.attr-name{color:#6f42c1;}.language-html .token.tag .token.attr-value,.language-html .token.tag .token.attr-value .token.punctuation:not(:first-child){color:#032f62;}.language-css .token.selector{color:#6f42c1;}.language-css .token.property{color:#005cc5;}</style><style id="__jsx-1038624251">.root.jsx-1038624251{display:block;padding:4rem 0;box-sizing:border-box;height:100%;}main.jsx-1038624251{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:100%;}@media (min-width:769px){.root.jsx-1038624251{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}main.jsx-1038624251{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}}</style></head><body><div id="__next"><div class="jsx-1038624251 root"><nav class="jsx-1038624251"><div class="jsx-3058196896 container "><div class="jsx-3058196896 meat meat-1"></div><div class="jsx-3058196896 meat meat-2"></div><div class="jsx-3058196896 meat meat-3"></div></div><div class="jsx-4138737674 container "><ul class="jsx-4138737674"><li class="jsx-4138737674"><a class="jsx-4138737674 " href="/">about</a></li><li class="jsx-4138737674"><a class="jsx-4138737674 " href="/projects">projects</a></li><li class="jsx-4138737674"><a class="jsx-4138737674 active" href="/posts">blog</a></li></ul></div></nav><main class="jsx-1038624251"><div class="jsx-3387257903 container"><article class="jsx-3387257903"><header class="jsx-3387257903"><h1 class="jsx-3387257903">Kubernetes aliases and functions using fzf - updated</h1><div class="jsx-3387257903 metadata"><div class="jsx-3387257903"><time dateTime="2023-02-02T00:00:00-08:00" class="jsx-3674465219"><span class="jsx-3674465219">February 2, 2023</span></time></div><div class="jsx-3387257903"><span class="jsx-3674465219">Brad Barrows</span></div></div></header><div class="jsx-3387257903 content_content__1yuPc"><div><h1>Note:</h1><p>Something with <em>kubectl</em> gostring formatting changed in the last few years.
I have updated the code below to fix any breaking changes (they were in the execute shell helpers).</p><p>I also added some functionality to get logs by deployment (<em>klogsdeployment</em>) so you can see the logs from all pods at once.
Which I do not believe any of the tools that people are using do.</p><p>The only requirement is running:</p><pre><code>    brew install fzf
</code></pre><p>before hand.</p><h2>The actual code ( add this to your .zshrc filec)</h2><pre><code>    alias kgp=&#x27;kubectl get pods --all-namespaces&#x27;
    alias kgs=&#x27;kubectl get services --all-namespaces&#x27;

    function kLogsPreviewAllContainers() {
        kubectl get pods --all-namespaces -o jsonpath=&#x27;{range .items[*]}{.metadata.namespace} {.metadata.name}{&quot;\n&quot;}&#x27; | fzf --preview=&quot;kubectl logs {2} --namespace {1} --all-containers&quot; --preview-window=up:80%
    }
    alias klogsp=kLogsPreviewAllContainers

    function kLogsAllContainers() {
        kubectl get pods --all-namespaces -o jsonpath=&#x27;{range .items[*]}{.metadata.namespace} {.metadata.name}{&quot;\n&quot;}&#x27; | fzf | read -r namespace pod
        kubectl logs $pod --namespace $namespace --all-containers -f
    }
    alias klogs=kLogsAllContainers

    function kLogsAllContainersAllPodsInDeployment() {
        kubectl get deployments --all-namespaces -o jsonpath=&#x27;{range .items[*]}{.metadata.namespace} {.metadata.name}{&quot;\n&quot;}&#x27; | fzf | read -r namespace deployment
        kubectl logs -f deployment/$deployment --namespace $namespace -f
    }
    alias klogsdeployment=kLogsAllContainersAllPodsInDeployment

    function kLogsContainer() {
        # The first argument to this function should be the container name
        # kubectl get pods -o name | fzf --preview=&quot;kubectl logs {} --container $1 | tail -20&quot; --preview-window=up:80%
        local container
        container=$1
        if [[ ! -z &quot;${container// }&quot; ]]; then
            kubectl get pods --all-namespaces -o jsonpath=&#x27;{range .items[*]}{.metadata.namespace} {.metadata.name}{&quot;\n&quot;}&#x27; | fzf --preview=&quot;echo kubectl logs {2} --namespace {1} --container $container&quot; --preview-window=up:80% --preview-label=&quot;Logs for container $1&quot;
        else
            print &quot;Usage: kLogsContainer &lt;container name&gt;&quot;
        fi
    }

    function kexSh() {
        local containers
        local container
        kubectl get pods --all-namespaces -o jsonpath=&#x27;{range .items[*]}{.metadata.namespace}{&quot;\t&quot;}{.metadata.name}{&quot;\n&quot;}&#x27; | fzf | read -r namespace pod
        containers=$(kubectl get pod -n $namespace $pod -o jsonpath=&#x27;{.spec.containers[*].name}&#x27;)
        container=$(echo ${containers/ /\\n} | fzf)
        kubectl exec -n $namespace --stdin --tty $pod --container $containers -- /bin/sh
    }


    function kexBash() {
        local containers
        local container
        kubectl get pods --all-namespaces -o jsonpath=&#x27;{range .items[*]}{.metadata.namespace}{&quot;\t&quot;}{.metadata.name}{&quot;\n&quot;}&#x27; | fzf | read -r namespace pod
        containers=$(kubectl get pod -n $namespace $pod -o jsonpath=&#x27;{.spec.containers[*].name}&#x27;)
        container=$(echo ${containers/ /\\n} | fzf)
        kubectl exec -n $namespace --stdin --tty $pod --container $container -- /bin/bash
    }

    function kd() {
        kubectl get $1 --all-namespaces -o jsonpath=&#x27;{range .items[*]}{.metadata.namespace}{&quot;\t&quot;}{.metadata.name}{&quot;\n&quot;}&#x27; | fzf --preview=&quot;echo &#x27;{}&#x27; | xargs kubectl describe $1 -n&quot; | xargs kubectl describe $1 -n
    }

    function kdelete() {
        kubectl get $1 --all-namespaces -o jsonpath=&#x27;{range .items[*]}{.metadata.namespace}{&quot;\t&quot;}{.metadata.name}{&quot;\n&quot;}&#x27; | fzf | xargs kubectl delete $1 -n
    }

    alias kdpod=&#x27;kd pod&#x27;

    alias kdelpod=&#x27;kdelete pod&#x27;

    alias kdservice=&#x27;kd service&#x27;

    alias kdelservice=&#x27;kdelete service&#x27;

    alias kg=&#x27;kubectl get &#x27;

    function kgevents() {  kubectl get events --sort-by=&#x27;.metadata.creationTimestamp&#x27;  }
    alias kgev=kgevents

</code></pre><h2>Helpful Kubernetes Aliases and Functions Explained</h2><p>I use fzf pretty extensively. I really appreciate how much time it can save looking up something like an id or namespace which will just need to be copied into the next command.</p><p>To save time I created a number of alises and functions which work with Kubernetes&#x27; kubectl to help me get information about a cluster and also exec shells.</p><p>It starts off with some aliases to help with monotonous tasks like getting a specific column and then there are some helpful command to describe and delete resources</p><h3>Describing resources</h3><p><img src="/static/kdpod.gif" alt="Describing pods"/></p><p>You could run:</p><pre><code>    kd service
</code></pre><p>or</p><pre><code>    kdservices
</code></pre><p>For pods:</p><pre><code>    kd pod
</code></pre><p>or</p><pre><code>    kdpods
</code></pre><p>The kd function will work with any resource type.</p><p>So</p><pre><code>    kd ingress
</code></pre><p>will even work to list all ingresses in all namespaces and then describe the one you select.</p><p>Command starting with kdel will delete resources.</p><h3>Spawning a shell on a pod in a container</h3><p><img src="/static/kexsh.gif" alt="Spawning a shell on a pod in a container"/></p><p>To run a shell on a pod in a container run:</p><pre><code>    kexBash
</code></pre><p>or</p><pre><code>    kexSH
</code></pre><p>These are pretty useful little functions.</p><p>You will be able to select the pod you want to a shell into, and then a secondary fzf selection will occur for the container.</p><h3>Kubernetes Events ( Debugging Issues )</h3><p>The last and mose useful of all these is probably just getting events in a sorted order (by timestamp).</p><p>Kubernetes events has helped me debug by far the majority of the more challenging Kubernetes issues I hace run into.</p><pre><code>    kgevents
</code></pre><h4>Why are events useful?</h4><p>When I run into frustrating issues with Kubernetes, things that I overlooked, I am usually able to pretty quickly figure out what I missed just by looking at the events being logged.</p><p>For example, if you are missing some secret or something needed for a volume to mount, that will show up in Kubernetes events if I remember correctly.</p><p>I would deffinately recommend checking it out if you ever are stuck.</p></div></div></article><footer class="jsx-3387257903"><div class="jsx-3387257903 social-list"><div class="jsx-255066894"><a title="LinkedIn" href="https://www.linkedin.com/in/bbarrows/}" target="_blank" rel="noopener" class="jsx-255066894"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#222"><path fill="#444" d="M5.453 11.099v15.484H.297V11.099h5.156zm.328-4.781q.016 1.141-.789 1.906t-2.117.766h-.031q-1.281 0-2.063-.766T0 6.318q0-1.156.805-1.914t2.102-.758 2.078.758.797 1.914zM24 17.708v8.875h-5.141v-8.281q0-1.641-.633-2.57t-1.977-.93q-.984 0-1.648.539t-.992 1.336q-.172.469-.172 1.266v8.641H8.296q.031-6.234.031-10.109t-.016-4.625l-.016-.75h5.141v2.25h-.031q.312-.5.641-.875t.883-.812 1.359-.68 1.789-.242q2.672 0 4.297 1.773t1.625 5.195z"></path></svg></a><a title="GitHub" href="https://github.com/bebrws/" target="_blank" rel="noopener" class="jsx-255066894"><svg viewBox="0 0 11 11" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" width="24" height="24" fill="#222"><path d="M10.5 5.63a4.992 4.992 0 01-.977 3.016A5.018 5.018 0 016.998 10.5c-.12.022-.207.007-.263-.047a.267.267 0 01-.083-.2v-1.41c0-.432-.116-.748-.347-.948.253-.027.481-.067.683-.12.203-.054.412-.14.627-.26.216-.121.396-.27.54-.445.145-.176.263-.41.354-.702.091-.291.137-.626.137-1.005a1.95 1.95 0 00-.527-1.376c.164-.405.147-.86-.053-1.363-.125-.04-.305-.015-.54.074a3.59 3.59 0 00-.614.294l-.254.16a4.727 4.727 0 00-1.28-.174c-.44 0-.867.058-1.28.174a5.931 5.931 0 00-.284-.18 3.995 3.995 0 00-.557-.258c-.254-.1-.445-.13-.574-.09-.195.504-.211.958-.046 1.363a1.95 1.95 0 00-.527 1.376c0 .379.045.713.136 1.002.092.29.208.523.35.702.143.178.322.327.537.447.216.12.425.207.627.26.203.054.43.094.684.12-.178.161-.287.39-.327.689a1.32 1.32 0 01-.3.1 1.885 1.885 0 01-.38.034A.785.785 0 013 8.573a1.177 1.177 0 01-.37-.418 1.077 1.077 0 00-.324-.347.973.973 0 00-.33-.16l-.133-.02a.432.432 0 00-.194.03c-.035.02-.046.045-.033.077a.487.487 0 00.147.174l.046.033c.098.044.195.129.29.254.096.124.166.238.21.34l.067.154c.058.17.156.306.294.41.138.105.287.172.447.201.16.029.314.045.463.047a1.96 1.96 0 00.37-.024l.154-.026a62.026 62.026 0 00.007.955c0 .08-.03.147-.087.2-.058.054-.147.07-.267.047a5.018 5.018 0 01-2.524-1.854A4.992 4.992 0 01.255 5.63c0-.93.23-1.789.687-2.575a5.103 5.103 0 011.865-1.867A5.005 5.005 0 015.377.5c.93 0 1.787.23 2.572.688a5.103 5.103 0 011.864 1.867c.458.786.687 1.645.687 2.575z" fill="#444" fill-rule="nonzero"></path></svg></a></div></div><p class="jsx-3618008669">© 2021</p></footer></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Kubernetes aliases and functions using fzf - updated","dateString":"2023-02-02","slug":"kubernetes-aliases-functions","description":"","tags":["kubernetes"],"author":"bebrws","source":{"compiledSource":"\"use strict\";\n\nvar _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"Note:\"), mdx(\"p\", null, \"Something with \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"kubectl\"), \" gostring formatting changed in the last few years.\\nI have updated the code below to fix any breaking changes (they were in the execute shell helpers).\"), mdx(\"p\", null, \"I also added some functionality to get logs by deployment (\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"klogsdeployment\"), \") so you can see the logs from all pods at once.\\nWhich I do not believe any of the tools that people are using do.\"), mdx(\"p\", null, \"The only requirement is running:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    brew install fzf\\n\")), mdx(\"p\", null, \"before hand.\"), mdx(\"h2\", null, \"The actual code ( add this to your .zshrc filec)\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    alias kgp='kubectl get pods --all-namespaces'\\n    alias kgs='kubectl get services --all-namespaces'\\n\\n    function kLogsPreviewAllContainers() {\\n        kubectl get pods --all-namespaces -o jsonpath='{range .items[*]}{.metadata.namespace} {.metadata.name}{\\\"\\\\n\\\"}' | fzf --preview=\\\"kubectl logs {2} --namespace {1} --all-containers\\\" --preview-window=up:80%\\n    }\\n    alias klogsp=kLogsPreviewAllContainers\\n\\n    function kLogsAllContainers() {\\n        kubectl get pods --all-namespaces -o jsonpath='{range .items[*]}{.metadata.namespace} {.metadata.name}{\\\"\\\\n\\\"}' | fzf | read -r namespace pod\\n        kubectl logs $pod --namespace $namespace --all-containers -f\\n    }\\n    alias klogs=kLogsAllContainers\\n\\n    function kLogsAllContainersAllPodsInDeployment() {\\n        kubectl get deployments --all-namespaces -o jsonpath='{range .items[*]}{.metadata.namespace} {.metadata.name}{\\\"\\\\n\\\"}' | fzf | read -r namespace deployment\\n        kubectl logs -f deployment/$deployment --namespace $namespace -f\\n    }\\n    alias klogsdeployment=kLogsAllContainersAllPodsInDeployment\\n\\n    function kLogsContainer() {\\n        # The first argument to this function should be the container name\\n        # kubectl get pods -o name | fzf --preview=\\\"kubectl logs {} --container $1 | tail -20\\\" --preview-window=up:80%\\n        local container\\n        container=$1\\n        if [[ ! -z \\\"${container// }\\\" ]]; then\\n            kubectl get pods --all-namespaces -o jsonpath='{range .items[*]}{.metadata.namespace} {.metadata.name}{\\\"\\\\n\\\"}' | fzf --preview=\\\"echo kubectl logs {2} --namespace {1} --container $container\\\" --preview-window=up:80% --preview-label=\\\"Logs for container $1\\\"\\n        else\\n            print \\\"Usage: kLogsContainer \u003ccontainer name\u003e\\\"\\n        fi\\n    }\\n\\n    function kexSh() {\\n        local containers\\n        local container\\n        kubectl get pods --all-namespaces -o jsonpath='{range .items[*]}{.metadata.namespace}{\\\"\\\\t\\\"}{.metadata.name}{\\\"\\\\n\\\"}' | fzf | read -r namespace pod\\n        containers=$(kubectl get pod -n $namespace $pod -o jsonpath='{.spec.containers[*].name}')\\n        container=$(echo ${containers/ /\\\\\\\\n} | fzf)\\n        kubectl exec -n $namespace --stdin --tty $pod --container $containers -- /bin/sh\\n    }\\n\\n\\n    function kexBash() {\\n        local containers\\n        local container\\n        kubectl get pods --all-namespaces -o jsonpath='{range .items[*]}{.metadata.namespace}{\\\"\\\\t\\\"}{.metadata.name}{\\\"\\\\n\\\"}' | fzf | read -r namespace pod\\n        containers=$(kubectl get pod -n $namespace $pod -o jsonpath='{.spec.containers[*].name}')\\n        container=$(echo ${containers/ /\\\\\\\\n} | fzf)\\n        kubectl exec -n $namespace --stdin --tty $pod --container $container -- /bin/bash\\n    }\\n\\n    function kd() {\\n        kubectl get $1 --all-namespaces -o jsonpath='{range .items[*]}{.metadata.namespace}{\\\"\\\\t\\\"}{.metadata.name}{\\\"\\\\n\\\"}' | fzf --preview=\\\"echo '{}' | xargs kubectl describe $1 -n\\\" | xargs kubectl describe $1 -n\\n    }\\n\\n    function kdelete() {\\n        kubectl get $1 --all-namespaces -o jsonpath='{range .items[*]}{.metadata.namespace}{\\\"\\\\t\\\"}{.metadata.name}{\\\"\\\\n\\\"}' | fzf | xargs kubectl delete $1 -n\\n    }\\n\\n    alias kdpod='kd pod'\\n\\n    alias kdelpod='kdelete pod'\\n\\n    alias kdservice='kd service'\\n\\n    alias kdelservice='kdelete service'\\n\\n    alias kg='kubectl get '\\n\\n    function kgevents() {  kubectl get events --sort-by='.metadata.creationTimestamp'  }\\n    alias kgev=kgevents\\n\\n\")), mdx(\"h2\", null, \"Helpful Kubernetes Aliases and Functions Explained\"), mdx(\"p\", null, \"I use fzf pretty extensively. I really appreciate how much time it can save looking up something like an id or namespace which will just need to be copied into the next command.\"), mdx(\"p\", null, \"To save time I created a number of alises and functions which work with Kubernetes' kubectl to help me get information about a cluster and also exec shells.\"), mdx(\"p\", null, \"It starts off with some aliases to help with monotonous tasks like getting a specific column and then there are some helpful command to describe and delete resources\"), mdx(\"h3\", null, \"Describing resources\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/static/kdpod.gif\",\n    \"alt\": \"Describing pods\"\n  })), mdx(\"p\", null, \"You could run:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    kd service\\n\")), mdx(\"p\", null, \"or\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    kdservices\\n\")), mdx(\"p\", null, \"For pods:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    kd pod\\n\")), mdx(\"p\", null, \"or\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    kdpods\\n\")), mdx(\"p\", null, \"The kd function will work with any resource type.\"), mdx(\"p\", null, \"So\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    kd ingress\\n\")), mdx(\"p\", null, \"will even work to list all ingresses in all namespaces and then describe the one you select.\"), mdx(\"p\", null, \"Command starting with kdel will delete resources.\"), mdx(\"h3\", null, \"Spawning a shell on a pod in a container\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/static/kexsh.gif\",\n    \"alt\": \"Spawning a shell on a pod in a container\"\n  })), mdx(\"p\", null, \"To run a shell on a pod in a container run:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    kexBash\\n\")), mdx(\"p\", null, \"or\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    kexSH\\n\")), mdx(\"p\", null, \"These are pretty useful little functions.\"), mdx(\"p\", null, \"You will be able to select the pod you want to a shell into, and then a secondary fzf selection will occur for the container.\"), mdx(\"h3\", null, \"Kubernetes Events ( Debugging Issues )\"), mdx(\"p\", null, \"The last and mose useful of all these is probably just getting events in a sorted order (by timestamp).\"), mdx(\"p\", null, \"Kubernetes events has helped me debug by far the majority of the more challenging Kubernetes issues I hace run into.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"    kgevents\\n\")), mdx(\"h4\", null, \"Why are events useful?\"), mdx(\"p\", null, \"When I run into frustrating issues with Kubernetes, things that I overlooked, I am usually able to pretty quickly figure out what I missed just by looking at the events being logged.\"), mdx(\"p\", null, \"For example, if you are missing some secret or something needed for a volume to mount, that will show up in Kubernetes events if I remember correctly.\"), mdx(\"p\", null, \"I would deffinately recommend checking it out if you ever are stuck.\"));\n}\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003ch1\u003eNote:\u003c/h1\u003e\u003cp\u003eSomething with \u003cem\u003ekubectl\u003c/em\u003e gostring formatting changed in the last few years.\nI have updated the code below to fix any breaking changes (they were in the execute shell helpers).\u003c/p\u003e\u003cp\u003eI also added some functionality to get logs by deployment (\u003cem\u003eklogsdeployment\u003c/em\u003e) so you can see the logs from all pods at once.\nWhich I do not believe any of the tools that people are using do.\u003c/p\u003e\u003cp\u003eThe only requirement is running:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e    brew install fzf\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ebefore hand.\u003c/p\u003e\u003ch2\u003eThe actual code ( add this to your .zshrc filec)\u003c/h2\u003e\u003cpre\u003e\u003ccode\u003e    alias kgp=\u0026#x27;kubectl get pods --all-namespaces\u0026#x27;\n    alias kgs=\u0026#x27;kubectl get services --all-namespaces\u0026#x27;\n\n    function kLogsPreviewAllContainers() {\n        kubectl get pods --all-namespaces -o jsonpath=\u0026#x27;{range .items[*]}{.metadata.namespace} {.metadata.name}{\u0026quot;\\n\u0026quot;}\u0026#x27; | fzf --preview=\u0026quot;kubectl logs {2} --namespace {1} --all-containers\u0026quot; --preview-window=up:80%\n    }\n    alias klogsp=kLogsPreviewAllContainers\n\n    function kLogsAllContainers() {\n        kubectl get pods --all-namespaces -o jsonpath=\u0026#x27;{range .items[*]}{.metadata.namespace} {.metadata.name}{\u0026quot;\\n\u0026quot;}\u0026#x27; | fzf | read -r namespace pod\n        kubectl logs $pod --namespace $namespace --all-containers -f\n    }\n    alias klogs=kLogsAllContainers\n\n    function kLogsAllContainersAllPodsInDeployment() {\n        kubectl get deployments --all-namespaces -o jsonpath=\u0026#x27;{range .items[*]}{.metadata.namespace} {.metadata.name}{\u0026quot;\\n\u0026quot;}\u0026#x27; | fzf | read -r namespace deployment\n        kubectl logs -f deployment/$deployment --namespace $namespace -f\n    }\n    alias klogsdeployment=kLogsAllContainersAllPodsInDeployment\n\n    function kLogsContainer() {\n        # The first argument to this function should be the container name\n        # kubectl get pods -o name | fzf --preview=\u0026quot;kubectl logs {} --container $1 | tail -20\u0026quot; --preview-window=up:80%\n        local container\n        container=$1\n        if [[ ! -z \u0026quot;${container// }\u0026quot; ]]; then\n            kubectl get pods --all-namespaces -o jsonpath=\u0026#x27;{range .items[*]}{.metadata.namespace} {.metadata.name}{\u0026quot;\\n\u0026quot;}\u0026#x27; | fzf --preview=\u0026quot;echo kubectl logs {2} --namespace {1} --container $container\u0026quot; --preview-window=up:80% --preview-label=\u0026quot;Logs for container $1\u0026quot;\n        else\n            print \u0026quot;Usage: kLogsContainer \u0026lt;container name\u0026gt;\u0026quot;\n        fi\n    }\n\n    function kexSh() {\n        local containers\n        local container\n        kubectl get pods --all-namespaces -o jsonpath=\u0026#x27;{range .items[*]}{.metadata.namespace}{\u0026quot;\\t\u0026quot;}{.metadata.name}{\u0026quot;\\n\u0026quot;}\u0026#x27; | fzf | read -r namespace pod\n        containers=$(kubectl get pod -n $namespace $pod -o jsonpath=\u0026#x27;{.spec.containers[*].name}\u0026#x27;)\n        container=$(echo ${containers/ /\\\\n} | fzf)\n        kubectl exec -n $namespace --stdin --tty $pod --container $containers -- /bin/sh\n    }\n\n\n    function kexBash() {\n        local containers\n        local container\n        kubectl get pods --all-namespaces -o jsonpath=\u0026#x27;{range .items[*]}{.metadata.namespace}{\u0026quot;\\t\u0026quot;}{.metadata.name}{\u0026quot;\\n\u0026quot;}\u0026#x27; | fzf | read -r namespace pod\n        containers=$(kubectl get pod -n $namespace $pod -o jsonpath=\u0026#x27;{.spec.containers[*].name}\u0026#x27;)\n        container=$(echo ${containers/ /\\\\n} | fzf)\n        kubectl exec -n $namespace --stdin --tty $pod --container $container -- /bin/bash\n    }\n\n    function kd() {\n        kubectl get $1 --all-namespaces -o jsonpath=\u0026#x27;{range .items[*]}{.metadata.namespace}{\u0026quot;\\t\u0026quot;}{.metadata.name}{\u0026quot;\\n\u0026quot;}\u0026#x27; | fzf --preview=\u0026quot;echo \u0026#x27;{}\u0026#x27; | xargs kubectl describe $1 -n\u0026quot; | xargs kubectl describe $1 -n\n    }\n\n    function kdelete() {\n        kubectl get $1 --all-namespaces -o jsonpath=\u0026#x27;{range .items[*]}{.metadata.namespace}{\u0026quot;\\t\u0026quot;}{.metadata.name}{\u0026quot;\\n\u0026quot;}\u0026#x27; | fzf | xargs kubectl delete $1 -n\n    }\n\n    alias kdpod=\u0026#x27;kd pod\u0026#x27;\n\n    alias kdelpod=\u0026#x27;kdelete pod\u0026#x27;\n\n    alias kdservice=\u0026#x27;kd service\u0026#x27;\n\n    alias kdelservice=\u0026#x27;kdelete service\u0026#x27;\n\n    alias kg=\u0026#x27;kubectl get \u0026#x27;\n\n    function kgevents() {  kubectl get events --sort-by=\u0026#x27;.metadata.creationTimestamp\u0026#x27;  }\n    alias kgev=kgevents\n\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eHelpful Kubernetes Aliases and Functions Explained\u003c/h2\u003e\u003cp\u003eI use fzf pretty extensively. I really appreciate how much time it can save looking up something like an id or namespace which will just need to be copied into the next command.\u003c/p\u003e\u003cp\u003eTo save time I created a number of alises and functions which work with Kubernetes\u0026#x27; kubectl to help me get information about a cluster and also exec shells.\u003c/p\u003e\u003cp\u003eIt starts off with some aliases to help with monotonous tasks like getting a specific column and then there are some helpful command to describe and delete resources\u003c/p\u003e\u003ch3\u003eDescribing resources\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"/static/kdpod.gif\" alt=\"Describing pods\"/\u003e\u003c/p\u003e\u003cp\u003eYou could run:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e    kd service\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eor\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e    kdservices\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eFor pods:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e    kd pod\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eor\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e    kdpods\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe kd function will work with any resource type.\u003c/p\u003e\u003cp\u003eSo\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e    kd ingress\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ewill even work to list all ingresses in all namespaces and then describe the one you select.\u003c/p\u003e\u003cp\u003eCommand starting with kdel will delete resources.\u003c/p\u003e\u003ch3\u003eSpawning a shell on a pod in a container\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"/static/kexsh.gif\" alt=\"Spawning a shell on a pod in a container\"/\u003e\u003c/p\u003e\u003cp\u003eTo run a shell on a pod in a container run:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e    kexBash\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eor\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e    kexSH\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThese are pretty useful little functions.\u003c/p\u003e\u003cp\u003eYou will be able to select the pod you want to a shell into, and then a secondary fzf selection will occur for the container.\u003c/p\u003e\u003ch3\u003eKubernetes Events ( Debugging Issues )\u003c/h3\u003e\u003cp\u003eThe last and mose useful of all these is probably just getting events in a sorted order (by timestamp).\u003c/p\u003e\u003cp\u003eKubernetes events has helped me debug by far the majority of the more challenging Kubernetes issues I hace run into.\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e    kgevents\n\u003c/code\u003e\u003c/pre\u003e\u003ch4\u003eWhy are events useful?\u003c/h4\u003e\u003cp\u003eWhen I run into frustrating issues with Kubernetes, things that I overlooked, I am usually able to pretty quickly figure out what I missed just by looking at the events being logged.\u003c/p\u003e\u003cp\u003eFor example, if you are missing some secret or something needed for a volume to mount, that will show up in Kubernetes events if I remember correctly.\u003c/p\u003e\u003cp\u003eI would deffinately recommend checking it out if you ever are stuck.\u003c/p\u003e","scope":{"slug":"kubernetes-aliases-functions","title":"Kubernetes aliases and functions using fzf - updated","date":"2023-02-02","author":"bebrws","tags":["kubernetes"]}}},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"kubernetes-aliases-functions"},"buildId":"-72x7XyjKLO7T9jMRO098","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>