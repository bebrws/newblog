<!DOCTYPE html><html><head><script type="text/javascript" class="jsx-707554062">
          
          function loadBevySnake() {
            setTimeout(function() {
            var element = document.getElementById('bevy-portal');
                  if (element) {
                    console.log('Element with id "bevy-portal" exists. Adding script tag.');

                  var script = document.createElement('script');
                  script.type = 'module';
                  script.src = '../static/load-bevy-snake.js';
                  document.head.appendChild(script);
            } else {
                    console.log('Element with id "bevy-portal" does not exist.');
                    loadBevySnake();
            }
          }, 500);
        }

        loadBevySnake();
      </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-154810525-2" class="jsx-707554062"></script><script type="text/javascript" class="jsx-707554062">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-154810525-2');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-BZKS5D8HPF" class="jsx-707554062"></script><script type="text/javascript" class="jsx-707554062">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-BZKS5D8HPF');
        </script><meta charSet="utf-8" class="jsx-707554062"/><meta name="viewport" content="width=device-width, initial-scale=1" class="jsx-707554062"/><link rel="manifest" href="/site.webmanifest" class="jsx-707554062"/><link rel="apple-touch-icon" href="/icon.png" class="jsx-707554062"/><meta name="theme-color" content="#fff" class="jsx-707554062"/><title>Wireguard | Brad Barrows&#x27; Blog</title><meta name="description" content="Brad Barrows&#x27; Blog"/><link rel="canonical" href="https://bbarrows.com/posts/wireguard"/><meta property="og:site_name" content="Brad Barrows&#x27; Blog"/><meta property="og:url" content="https://bbarrows.com/posts/wireguard"/><meta property="og:title" content="Wireguard | Brad Barrows&#x27; Blog"/><meta property="og:description" content="Brad Barrows&#x27; Blog"/><meta property="og:image" content="https://bbarrows.com/og_image.png"/><meta property="og:type" content="article"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":"https://bbarrows.com/posts/wireguard","headline":"Wireguard","datePublished":"2019-12-14T00:00:00-08:00","author":"Brad Barrows","description":""}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/8e11f38ccf46f6277e39.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e11f38ccf46f6277e39.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e884486185169a1848b2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e884486185169a1848b2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-f47d69457824065d04c3.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-d32200c037819e7e8fa0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-eae7af63eb651790e0a7.js" defer=""></script><script src="/_next/static/chunks/962-b2e3b32260744832b5cf.js" defer=""></script><script src="/_next/static/chunks/295-d2a92dd57ddb2277243a.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpost%5D-554a7f2db08ad8e20c9d.js" defer=""></script><script src="/_next/static/vLmAuvnBH1vcGrXpXTlw0/_buildManifest.js" defer=""></script><script src="/_next/static/vLmAuvnBH1vcGrXpXTlw0/_ssgManifest.js" defer=""></script><style id="__jsx-3058196896">.container.jsx-3058196896{position:fixed;width:38px;height:38px;cursor:pointer;top:1rem;left:1.25rem;z-index:2;background-color:rgba(255,255,255,0.7);}.meat.jsx-3058196896{position:absolute;width:28px;height:2px;background:#222;top:calc(50% - 2px / 2);left:calc(50% - 28px / 2);-webkit-transition:all 150ms ease-in;transition:all 150ms ease-in;}.meat-1.jsx-3058196896{-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px);transform:translateY(-10px);}.meat-2.jsx-3058196896{width:calc(28px - 6px);}.meat-3.jsx-3058196896{-webkit-transform:translateY(10px);-ms-transform:translateY(10px);transform:translateY(10px);}.active.jsx-3058196896 .meat-1.jsx-3058196896{-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);}.active.jsx-3058196896 .meat-2.jsx-3058196896{opacity:0;}.active.jsx-3058196896 .meat-3.jsx-3058196896{-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg);}@media (min-width:769px){.container.jsx-3058196896{display:none;}}</style><style id="__jsx-4138737674">.container.jsx-4138737674{width:0;}ul.jsx-4138737674{opacity:0;width:100%;height:100vh;text-align:right;list-style:none;margin:0;padding:0;position:fixed;top:0;background-color:#fff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;z-index:1;-webkit-transform:translateY(100%);-ms-transform:translateY(100%);transform:translateY(100%);-webkit-transition:opacity 200ms;transition:opacity 200ms;}.active.jsx-4138737674 ul.jsx-4138737674{opacity:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}li.jsx-4138737674{margin-bottom:1.75rem;font-size:2rem;padding:0 1.5rem 0 0;}li.jsx-4138737674:last-child{margin-bottom:0;}.active.jsx-4138737674{color:#222;}@media (min-width:769px){.container.jsx-4138737674{width:7rem;display:block;}ul.jsx-4138737674{opacity:1;width:7rem;top:auto;display:block;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}li.jsx-4138737674{font-size:1rem;padding:0;}}</style><style id="__jsx-3674465219">span.jsx-3674465219{color:#9b9b9b;}</style><style id="__jsx-255066894">a.jsx-255066894{display:inline-block;}a.jsx-255066894:not(:last-child){margin-right:2em;}</style><style id="__jsx-3618008669">p.jsx-3618008669{font-size:0.75rem;text-align:center;}</style><style id="__jsx-4153080612">.container.jsx-3387257903{display:block;max-width:60rem;width:100%;margin:0 auto;padding:0 1.5rem;box-sizing:border-box;z-index:0;}.metadata.jsx-3387257903 div.jsx-3387257903{display:inline-block;margin-right:0.5rem;}article.jsx-3387257903{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}h1.jsx-3387257903{margin:0 0 0.5rem;font-size:2.25rem;}.tag-list.jsx-3387257903{list-style:none;text-align:right;margin:1.75rem 0 0 0;padding:0;}.tag-list.jsx-3387257903 li.jsx-3387257903{display:inline-block;margin-left:0.5rem;}.social-list.jsx-3387257903{margin-top:3rem;text-align:center;}@media (min-width:769px){.container.jsx-3387257903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><style id="__jsx-1699270818">.token.comment,.token.prolog,.token.doctype,.token.cdata,.token.plain-text{color:#6a737d;}.token.atrule,.token.attr-value,.token.keyword,.token.operator{color:#d73a49;}.token.property,.token.tag,.token.boolean,.token.number,.token.constant,.token.symbol,.token.deleted{color:#22863a;}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#032f62;}.token.function,.token.class-name{color:#6f42c1;}.language-jsx .token.punctuation,.language-jsx .token.tag .token.punctuation,.language-jsx .token.tag .token.script,.language-jsx .token.plain-text{color:#24292e;}.language-jsx .token.tag .token.attr-name{color:#6f42c1;}.language-jsx .token.tag .token.class-name{color:#005cc5;}.language-jsx .token.tag .token.script-punctuation,.language-jsx .token.attr-value .token.punctuation:first-child{color:#d73a49;}.language-jsx .token.attr-value{color:#032f62;}.language-jsx span[class="comment"]{color:pink;}.language-html .token.tag .token.punctuation{color:#24292e;}.language-html .token.tag .token.attr-name{color:#6f42c1;}.language-html .token.tag .token.attr-value,.language-html .token.tag .token.attr-value .token.punctuation:not(:first-child){color:#032f62;}.language-css .token.selector{color:#6f42c1;}.language-css .token.property{color:#005cc5;}</style><style id="__jsx-707554062">.root.jsx-707554062{display:block;padding:4rem 0;box-sizing:border-box;height:100%;}main.jsx-707554062{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width:769px){.root.jsx-707554062{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}main.jsx-707554062{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}}</style></head><body><div id="__next"><div class="jsx-707554062 root"><nav class="jsx-707554062"><div class="jsx-3058196896 container "><div class="jsx-3058196896 meat meat-1"></div><div class="jsx-3058196896 meat meat-2"></div><div class="jsx-3058196896 meat meat-3"></div></div><div class="jsx-4138737674 container "><ul class="jsx-4138737674"><li class="jsx-4138737674"><a class="jsx-4138737674 " href="/">about</a></li><li class="jsx-4138737674"><a class="jsx-4138737674 " href="/projects">projects</a></li><li class="jsx-4138737674"><a class="jsx-4138737674 active" href="/posts">blog</a></li></ul></div></nav><main class="jsx-707554062"><div class="jsx-3387257903 container"><article class="jsx-3387257903"><header class="jsx-3387257903"><h1 class="jsx-3387257903">Wireguard</h1><div class="jsx-3387257903 metadata"><div class="jsx-3387257903"><time dateTime="2019-12-14T00:00:00-08:00" class="jsx-3674465219"><span class="jsx-3674465219">December 14, 2019</span></time></div><div class="jsx-3387257903"><span class="jsx-3674465219">Brad Barrows</span></div></div></header><div class="jsx-3387257903 content_content__1yuPc"><div><p>How to setup a Wireguard VPN for free!</p><p>Go grab a free account if you haven&#x27;t already signed for one from <a href="https://azure.microsoft.com/en-us/free/search/?&amp;ef_id=EAIaIQobChMIs6y5wYe25gIVFtRkCh3jJANyEAAYASABEgK6pvD_BwE:G:s&amp;OCID=AID2000128_SEM_hDTj6HPx&amp;MarinID=hDTj6HPx_287547081826_azure%20free%20account_e_c_TAwBQrMX_44568976297_kwd-300666823650&amp;lnkd=Google_Azure_Brand&amp;gclid=EAIaIQobChMIs6y5wYe25gIVFtRkCh3jJANyEAAYASABEgK6pvD_BwE">Azure</a> or you could use your AWS free compute hours with a small EC2 instance.</p><p>Create a the small VM that fits in the free price range</p><p>Set the networking rules to allow ANY traffic TCP/UDP over port 51820 (Wireguard really only used UDP though I am pretty sure).
In azure you would do this by creating the <a href="https://azuremarketplace.microsoft.com/en-us/marketplace/apps/microsoft.freeaccountvirtualmachine?tab=Overview">Free VM</a> (which can be created with a few clicks from that link after creating your account). Then once the VM is created and ready you and you have a status of &quot;Your deployment is complete&quot; you can open the &quot;Deployment details&quot; section and click on the Resource link of Type &quot;Microsoft.Compute/virtumachines&quot;.</p><p>In the left sidebar there will be a link for Networking. Click this.</p><p>On the networking page click &quot;Add Inbound port rule&quot;.</p><p>Create a rule with the following:</p><pre><code>   Source: Any
   Source port range: *
   Destination: Any
   Desitnation port range: 51820
   Protocal: Any
   Action: Allow
   PriorityL 380
   Name: Port_51820
   Description: Wireguard
</code></pre><p>SSH into your VM.</p><p>Run the following:</p><pre><code># Generate public and private keys

umask 077
wg genkey | tee privatekey | wg pubkey &gt; publickey

# Run these as root

sudo su

cat &lt;&lt; EOF &gt;&gt; /etc/sysctl.conf
net.ipv4.ip_forward=1
net.ipv6.conf.all.forwarding=1
EOF

add-apt-repository ppa:wireguard/wireguard
apt-get update
apt-get install wireguard

echo &quot;This is the Server Private Key:&quot;
cat privatekey

echo &quot;This is the Server Public Key:&quot;
cat publickey

echo &quot;This will be the Client Private Key if you need to generate one (using the OSX Wireguardd App?):&quot;
wg genkey | sudo tee clientprivatekey
cat clientprivatekey
</code></pre><p>Now if you are using the OSX Wireguard App you will create a new &quot;empty tunnnel&quot; by clicking the bottom left plus button. Paste in the following replacing IPAddressOfYourServer with your VM IP and then replace ClientPrivateKey with the value from the clientprivatekey file. ServerPublicKey will be replaced with the Server Public Key:</p><pre><code>[Interface]
PrivateKey = ClientPrivateKey
ListenPort = 21841
Address = 192.168.2.2/32
DNS = 1.1.1.1

[Peer]
PublicKey = ServerPublicKey
AllowedIPs = 0.0.0.0/0, ::/0
Endpoint = IPAddressOfYourServer:51820
PersistentKeepalive = 25
</code></pre><p>After replacing the values I mentioned and copying this into the Wireguard OSX App you will have a Client Public Key generated. It will be right above the text box you paste the configuration into. Take this value and replace PublicKeyFromClient&gt; with it. Replace &lt;PrivateKeyfromthe2ndComnmandAbove with the Server Private Key that was printed out in the last set of commands you ran on the VM. The run the following on your VM:</p><pre><code>cat &lt;&lt; EOF &gt;&gt; /etc/wireguard/wg0.conf
[Interface]
Address = 192.168.2.1
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables -A FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6tables -D FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
ListenPort = 51820
PrivateKey = PrivateKeyfromthe2ndComnmandAbove
DNS = 1.1.1.1


[Peer]
PublicKey = PublicKeyFromClient
AllowedIPs = 192.168.2.2/32
EOF

</code></pre><p>You may also want to setup a firewall on your VM by running:</p><pre><code>sudo ufw allow 22/tcp
sudo ufw allow 51820/udp
sudo ufw enable
</code></pre><p>This is optional.</p><p>It is time to start the Wiregaurd server.
Run this on your VM:</p><pre><code>sudo wg-quick up wg0
sudo systemctl enable wg-quick@wg0 # Set wireguard to run on system start
sudo wg show # Check the status
</code></pre><p>Note: after every change to your /etc/wiregaurd/wg0.conf file you will need to bring the wiregaurd service down and back up again:</p><pre><code>sudo wg-quick down wg0
sudo wg-quick up wg0
</code></pre><p>You should now be able to go back to you Wireguard client and activate the connection. Google &quot;What Is My IP&quot; and verify that your IP has changed. You could then also try checking if you have DNS Leaks. Note that I am using Cloudflare DNS. I believe for a really secure VPN you would want to install DNS on your VPN as well but I have not bothered to attempt that yet.</p><p>Other resources:</p><p><a href="https://securityespresso.org/tutorials/2019/03/22/vpn-server-using-wireguard-on-ubuntu/">Another Ubuntu based tutorial</a></p><p><a href="https://www.linode.com/docs/networking/vpn/set-up-wireguard-vpn-on-ubuntu/">Linode&#x27;s tutorial which I had trouble with</a></p></div></div></article><footer class="jsx-3387257903"><div class="jsx-3387257903 social-list"><div class="jsx-255066894"><a title="LinkedIn" href="https://www.linkedin.com/in/bbarrows/}" target="_blank" rel="noopener" class="jsx-255066894"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#222"><path fill="#444" d="M5.453 11.099v15.484H.297V11.099h5.156zm.328-4.781q.016 1.141-.789 1.906t-2.117.766h-.031q-1.281 0-2.063-.766T0 6.318q0-1.156.805-1.914t2.102-.758 2.078.758.797 1.914zM24 17.708v8.875h-5.141v-8.281q0-1.641-.633-2.57t-1.977-.93q-.984 0-1.648.539t-.992 1.336q-.172.469-.172 1.266v8.641H8.296q.031-6.234.031-10.109t-.016-4.625l-.016-.75h5.141v2.25h-.031q.312-.5.641-.875t.883-.812 1.359-.68 1.789-.242q2.672 0 4.297 1.773t1.625 5.195z"></path></svg></a><a title="GitHub" href="https://github.com/bebrws/" target="_blank" rel="noopener" class="jsx-255066894"><svg viewBox="0 0 11 11" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" width="24" height="24" fill="#222"><path d="M10.5 5.63a4.992 4.992 0 01-.977 3.016A5.018 5.018 0 016.998 10.5c-.12.022-.207.007-.263-.047a.267.267 0 01-.083-.2v-1.41c0-.432-.116-.748-.347-.948.253-.027.481-.067.683-.12.203-.054.412-.14.627-.26.216-.121.396-.27.54-.445.145-.176.263-.41.354-.702.091-.291.137-.626.137-1.005a1.95 1.95 0 00-.527-1.376c.164-.405.147-.86-.053-1.363-.125-.04-.305-.015-.54.074a3.59 3.59 0 00-.614.294l-.254.16a4.727 4.727 0 00-1.28-.174c-.44 0-.867.058-1.28.174a5.931 5.931 0 00-.284-.18 3.995 3.995 0 00-.557-.258c-.254-.1-.445-.13-.574-.09-.195.504-.211.958-.046 1.363a1.95 1.95 0 00-.527 1.376c0 .379.045.713.136 1.002.092.29.208.523.35.702.143.178.322.327.537.447.216.12.425.207.627.26.203.054.43.094.684.12-.178.161-.287.39-.327.689a1.32 1.32 0 01-.3.1 1.885 1.885 0 01-.38.034A.785.785 0 013 8.573a1.177 1.177 0 01-.37-.418 1.077 1.077 0 00-.324-.347.973.973 0 00-.33-.16l-.133-.02a.432.432 0 00-.194.03c-.035.02-.046.045-.033.077a.487.487 0 00.147.174l.046.033c.098.044.195.129.29.254.096.124.166.238.21.34l.067.154c.058.17.156.306.294.41.138.105.287.172.447.201.16.029.314.045.463.047a1.96 1.96 0 00.37-.024l.154-.026a62.026 62.026 0 00.007.955c0 .08-.03.147-.087.2-.058.054-.147.07-.267.047a5.018 5.018 0 01-2.524-1.854A4.992 4.992 0 01.255 5.63c0-.93.23-1.789.687-2.575a5.103 5.103 0 011.865-1.867A5.005 5.005 0 015.377.5c.93 0 1.787.23 2.572.688a5.103 5.103 0 011.864 1.867c.458.786.687 1.645.687 2.575z" fill="#444" fill-rule="nonzero"></path></svg></a></div></div><p class="jsx-3618008669">© 2021</p></footer></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Wireguard","dateString":"2019-12-14","slug":"wireguard","description":"","tags":["linux","wireguard"],"author":"bebrws","source":{"compiledSource":"\"use strict\";\n\nvar _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"How to setup a Wireguard VPN for free!\"), mdx(\"p\", null, \"Go grab a free account if you haven't already signed for one from \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://azure.microsoft.com/en-us/free/search/?\u0026ef_id=EAIaIQobChMIs6y5wYe25gIVFtRkCh3jJANyEAAYASABEgK6pvD_BwE:G:s\u0026OCID=AID2000128_SEM_hDTj6HPx\u0026MarinID=hDTj6HPx_287547081826_azure%20free%20account_e_c_TAwBQrMX_44568976297_kwd-300666823650\u0026lnkd=Google_Azure_Brand\u0026gclid=EAIaIQobChMIs6y5wYe25gIVFtRkCh3jJANyEAAYASABEgK6pvD_BwE\"\n  }, \"Azure\"), \" or you could use your AWS free compute hours with a small EC2 instance.\"), mdx(\"p\", null, \"Create a the small VM that fits in the free price range\"), mdx(\"p\", null, \"Set the networking rules to allow ANY traffic TCP/UDP over port 51820 (Wireguard really only used UDP though I am pretty sure).\\nIn azure you would do this by creating the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/microsoft.freeaccountvirtualmachine?tab=Overview\"\n  }, \"Free VM\"), \" (which can be created with a few clicks from that link after creating your account). Then once the VM is created and ready you and you have a status of \\\"Your deployment is complete\\\" you can open the \\\"Deployment details\\\" section and click on the Resource link of Type \\\"Microsoft.Compute/virtumachines\\\".\"), mdx(\"p\", null, \"In the left sidebar there will be a link for Networking. Click this.\"), mdx(\"p\", null, \"On the networking page click \\\"Add Inbound port rule\\\".\"), mdx(\"p\", null, \"Create a rule with the following:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"   Source: Any\\n   Source port range: *\\n   Destination: Any\\n   Desitnation port range: 51820\\n   Protocal: Any\\n   Action: Allow\\n   PriorityL 380\\n   Name: Port_51820\\n   Description: Wireguard\\n\")), mdx(\"p\", null, \"SSH into your VM.\"), mdx(\"p\", null, \"Run the following:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"# Generate public and private keys\\n\\numask 077\\nwg genkey | tee privatekey | wg pubkey \u003e publickey\\n\\n# Run these as root\\n\\nsudo su\\n\\ncat \u003c\u003c EOF \u003e\u003e /etc/sysctl.conf\\nnet.ipv4.ip_forward=1\\nnet.ipv6.conf.all.forwarding=1\\nEOF\\n\\nadd-apt-repository ppa:wireguard/wireguard\\napt-get update\\napt-get install wireguard\\n\\necho \\\"This is the Server Private Key:\\\"\\ncat privatekey\\n\\necho \\\"This is the Server Public Key:\\\"\\ncat publickey\\n\\necho \\\"This will be the Client Private Key if you need to generate one (using the OSX Wireguardd App?):\\\"\\nwg genkey | sudo tee clientprivatekey\\ncat clientprivatekey\\n\")), mdx(\"p\", null, \"Now if you are using the OSX Wireguard App you will create a new \\\"empty tunnnel\\\" by clicking the bottom left plus button. Paste in the following replacing IPAddressOfYourServer with your VM IP and then replace ClientPrivateKey with the value from the clientprivatekey file. ServerPublicKey will be replaced with the Server Public Key:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"[Interface]\\nPrivateKey = ClientPrivateKey\\nListenPort = 21841\\nAddress = 192.168.2.2/32\\nDNS = 1.1.1.1\\n\\n[Peer]\\nPublicKey = ServerPublicKey\\nAllowedIPs = 0.0.0.0/0, ::/0\\nEndpoint = IPAddressOfYourServer:51820\\nPersistentKeepalive = 25\\n\")), mdx(\"p\", null, \"After replacing the values I mentioned and copying this into the Wireguard OSX App you will have a Client Public Key generated. It will be right above the text box you paste the configuration into. Take this value and replace PublicKeyFromClient\u003e with it. Replace \u003cPrivateKeyfromthe2ndComnmandAbove with the Server Private Key that was printed out in the last set of commands you ran on the VM. The run the following on your VM:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"cat \u003c\u003c EOF \u003e\u003e /etc/wireguard/wg0.conf\\n[Interface]\\nAddress = 192.168.2.1\\nPostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables -A FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\\nPostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6tables -D FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -D POSTROUTING -o eth0 -j MASQUERADE\\nListenPort = 51820\\nPrivateKey = PrivateKeyfromthe2ndComnmandAbove\\nDNS = 1.1.1.1\\n\\n\\n[Peer]\\nPublicKey = PublicKeyFromClient\\nAllowedIPs = 192.168.2.2/32\\nEOF\\n\\n\")), mdx(\"p\", null, \"You may also want to setup a firewall on your VM by running:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"sudo ufw allow 22/tcp\\nsudo ufw allow 51820/udp\\nsudo ufw enable\\n\")), mdx(\"p\", null, \"This is optional.\"), mdx(\"p\", null, \"It is time to start the Wiregaurd server.\\nRun this on your VM:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"sudo wg-quick up wg0\\nsudo systemctl enable wg-quick@wg0 # Set wireguard to run on system start\\nsudo wg show # Check the status\\n\")), mdx(\"p\", null, \"Note: after every change to your /etc/wiregaurd/wg0.conf file you will need to bring the wiregaurd service down and back up again:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"sudo wg-quick down wg0\\nsudo wg-quick up wg0\\n\")), mdx(\"p\", null, \"You should now be able to go back to you Wireguard client and activate the connection. Google \\\"What Is My IP\\\" and verify that your IP has changed. You could then also try checking if you have DNS Leaks. Note that I am using Cloudflare DNS. I believe for a really secure VPN you would want to install DNS on your VPN as well but I have not bothered to attempt that yet.\"), mdx(\"p\", null, \"Other resources:\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://securityespresso.org/tutorials/2019/03/22/vpn-server-using-wireguard-on-ubuntu/\"\n  }, \"Another Ubuntu based tutorial\")), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.linode.com/docs/networking/vpn/set-up-wireguard-vpn-on-ubuntu/\"\n  }, \"Linode's tutorial which I had trouble with\")));\n}\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003cp\u003eHow to setup a Wireguard VPN for free!\u003c/p\u003e\u003cp\u003eGo grab a free account if you haven\u0026#x27;t already signed for one from \u003ca href=\"https://azure.microsoft.com/en-us/free/search/?\u0026amp;ef_id=EAIaIQobChMIs6y5wYe25gIVFtRkCh3jJANyEAAYASABEgK6pvD_BwE:G:s\u0026amp;OCID=AID2000128_SEM_hDTj6HPx\u0026amp;MarinID=hDTj6HPx_287547081826_azure%20free%20account_e_c_TAwBQrMX_44568976297_kwd-300666823650\u0026amp;lnkd=Google_Azure_Brand\u0026amp;gclid=EAIaIQobChMIs6y5wYe25gIVFtRkCh3jJANyEAAYASABEgK6pvD_BwE\"\u003eAzure\u003c/a\u003e or you could use your AWS free compute hours with a small EC2 instance.\u003c/p\u003e\u003cp\u003eCreate a the small VM that fits in the free price range\u003c/p\u003e\u003cp\u003eSet the networking rules to allow ANY traffic TCP/UDP over port 51820 (Wireguard really only used UDP though I am pretty sure).\nIn azure you would do this by creating the \u003ca href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/microsoft.freeaccountvirtualmachine?tab=Overview\"\u003eFree VM\u003c/a\u003e (which can be created with a few clicks from that link after creating your account). Then once the VM is created and ready you and you have a status of \u0026quot;Your deployment is complete\u0026quot; you can open the \u0026quot;Deployment details\u0026quot; section and click on the Resource link of Type \u0026quot;Microsoft.Compute/virtumachines\u0026quot;.\u003c/p\u003e\u003cp\u003eIn the left sidebar there will be a link for Networking. Click this.\u003c/p\u003e\u003cp\u003eOn the networking page click \u0026quot;Add Inbound port rule\u0026quot;.\u003c/p\u003e\u003cp\u003eCreate a rule with the following:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e   Source: Any\n   Source port range: *\n   Destination: Any\n   Desitnation port range: 51820\n   Protocal: Any\n   Action: Allow\n   PriorityL 380\n   Name: Port_51820\n   Description: Wireguard\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eSSH into your VM.\u003c/p\u003e\u003cp\u003eRun the following:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e# Generate public and private keys\n\numask 077\nwg genkey | tee privatekey | wg pubkey \u0026gt; publickey\n\n# Run these as root\n\nsudo su\n\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/sysctl.conf\nnet.ipv4.ip_forward=1\nnet.ipv6.conf.all.forwarding=1\nEOF\n\nadd-apt-repository ppa:wireguard/wireguard\napt-get update\napt-get install wireguard\n\necho \u0026quot;This is the Server Private Key:\u0026quot;\ncat privatekey\n\necho \u0026quot;This is the Server Public Key:\u0026quot;\ncat publickey\n\necho \u0026quot;This will be the Client Private Key if you need to generate one (using the OSX Wireguardd App?):\u0026quot;\nwg genkey | sudo tee clientprivatekey\ncat clientprivatekey\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow if you are using the OSX Wireguard App you will create a new \u0026quot;empty tunnnel\u0026quot; by clicking the bottom left plus button. Paste in the following replacing IPAddressOfYourServer with your VM IP and then replace ClientPrivateKey with the value from the clientprivatekey file. ServerPublicKey will be replaced with the Server Public Key:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e[Interface]\nPrivateKey = ClientPrivateKey\nListenPort = 21841\nAddress = 192.168.2.2/32\nDNS = 1.1.1.1\n\n[Peer]\nPublicKey = ServerPublicKey\nAllowedIPs = 0.0.0.0/0, ::/0\nEndpoint = IPAddressOfYourServer:51820\nPersistentKeepalive = 25\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAfter replacing the values I mentioned and copying this into the Wireguard OSX App you will have a Client Public Key generated. It will be right above the text box you paste the configuration into. Take this value and replace PublicKeyFromClient\u0026gt; with it. Replace \u0026lt;PrivateKeyfromthe2ndComnmandAbove with the Server Private Key that was printed out in the last set of commands you ran on the VM. The run the following on your VM:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003ecat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/wireguard/wg0.conf\n[Interface]\nAddress = 192.168.2.1\nPostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables -A FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\nPostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6tables -D FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -D POSTROUTING -o eth0 -j MASQUERADE\nListenPort = 51820\nPrivateKey = PrivateKeyfromthe2ndComnmandAbove\nDNS = 1.1.1.1\n\n\n[Peer]\nPublicKey = PublicKeyFromClient\nAllowedIPs = 192.168.2.2/32\nEOF\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eYou may also want to setup a firewall on your VM by running:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003esudo ufw allow 22/tcp\nsudo ufw allow 51820/udp\nsudo ufw enable\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis is optional.\u003c/p\u003e\u003cp\u003eIt is time to start the Wiregaurd server.\nRun this on your VM:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003esudo wg-quick up wg0\nsudo systemctl enable wg-quick@wg0 # Set wireguard to run on system start\nsudo wg show # Check the status\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNote: after every change to your /etc/wiregaurd/wg0.conf file you will need to bring the wiregaurd service down and back up again:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003esudo wg-quick down wg0\nsudo wg-quick up wg0\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eYou should now be able to go back to you Wireguard client and activate the connection. Google \u0026quot;What Is My IP\u0026quot; and verify that your IP has changed. You could then also try checking if you have DNS Leaks. Note that I am using Cloudflare DNS. I believe for a really secure VPN you would want to install DNS on your VPN as well but I have not bothered to attempt that yet.\u003c/p\u003e\u003cp\u003eOther resources:\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://securityespresso.org/tutorials/2019/03/22/vpn-server-using-wireguard-on-ubuntu/\"\u003eAnother Ubuntu based tutorial\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://www.linode.com/docs/networking/vpn/set-up-wireguard-vpn-on-ubuntu/\"\u003eLinode\u0026#x27;s tutorial which I had trouble with\u003c/a\u003e\u003c/p\u003e","scope":{"slug":"wireguard","title":"Wireguard","date":"2019-12-14","author":"bebrws","tags":["linux","wireguard"]}}},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"wireguard"},"buildId":"vLmAuvnBH1vcGrXpXTlw0","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>