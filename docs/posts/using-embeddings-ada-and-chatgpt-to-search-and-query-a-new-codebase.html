<!DOCTYPE html><html><head><script type="text/javascript" class="jsx-707554062">
          
          function loadBevySnake() {
            setTimeout(function() {
            var element = document.getElementById('bevy-portal');
                  if (element) {
                    console.log('Element with id "bevy-portal" exists. Adding script tag.');

                  var script = document.createElement('script');
                  script.type = 'module';
                  script.src = '../static/load-bevy-snake.js';
                  document.head.appendChild(script);
            } else {
                    console.log('Element with id "bevy-portal" does not exist.');
                    loadBevySnake();
            }
          }, 500);
        }

        loadBevySnake();
      </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-154810525-2" class="jsx-707554062"></script><script type="text/javascript" class="jsx-707554062">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-154810525-2');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-BZKS5D8HPF" class="jsx-707554062"></script><script type="text/javascript" class="jsx-707554062">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-BZKS5D8HPF');
        </script><meta charSet="utf-8" class="jsx-707554062"/><meta name="viewport" content="width=device-width, initial-scale=1" class="jsx-707554062"/><link rel="manifest" href="/site.webmanifest" class="jsx-707554062"/><link rel="apple-touch-icon" href="/icon.png" class="jsx-707554062"/><meta name="theme-color" content="#fff" class="jsx-707554062"/><title>Search (ada) and Query (gpt-3.5-turbo) Your Codebases Using OpenAI&#x27;s Embeddings and ChatGPT | Brad Barrows&#x27; Blog</title><meta name="description" content="Brad Barrows&#x27; Blog"/><link rel="canonical" href="https://bbarrows.com/posts/using-embeddings-ada-and-chatgpt-to-search-and-query-a-new-codebase"/><meta property="og:site_name" content="Brad Barrows&#x27; Blog"/><meta property="og:url" content="https://bbarrows.com/posts/using-embeddings-ada-and-chatgpt-to-search-and-query-a-new-codebase"/><meta property="og:title" content="Search (ada) and Query (gpt-3.5-turbo) Your Codebases Using OpenAI&#x27;s Embeddings and ChatGPT | Brad Barrows&#x27; Blog"/><meta property="og:description" content="Brad Barrows&#x27; Blog"/><meta property="og:image" content="https://bbarrows.com/og_image.png"/><meta property="og:type" content="article"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":"https://bbarrows.com/posts/using-embeddings-ada-and-chatgpt-to-search-and-query-a-new-codebase","headline":"Search (ada) and Query (gpt-3.5-turbo) Your Codebases Using OpenAI&apos;s Embeddings and ChatGPT","datePublished":"2023-03-01T00:00:00-08:00","author":"Brad Barrows","description":""}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/8e11f38ccf46f6277e39.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e11f38ccf46f6277e39.css" data-n-g=""/><link rel="preload" href="/_next/static/css/08c00d6a07e310229cb0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08c00d6a07e310229cb0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-f47d69457824065d04c3.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-d32200c037819e7e8fa0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-eae7af63eb651790e0a7.js" defer=""></script><script src="/_next/static/chunks/962-b2e3b32260744832b5cf.js" defer=""></script><script src="/_next/static/chunks/189-6fa1af65347fdf66ab7b.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpost%5D-798896a96beb46d3eaba.js" defer=""></script><script src="/_next/static/nENEKRtsitJh7ixPHU9Bl/_buildManifest.js" defer=""></script><script src="/_next/static/nENEKRtsitJh7ixPHU9Bl/_ssgManifest.js" defer=""></script><style id="__jsx-2373991563">a.jsx-2373991563{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a.jsx-2373991563:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><style id="__jsx-3058196896">.container.jsx-3058196896{position:fixed;width:38px;height:38px;cursor:pointer;top:1rem;left:1.25rem;z-index:2;background-color:rgba(255,255,255,0.7);}.meat.jsx-3058196896{position:absolute;width:28px;height:2px;background:#222;top:calc(50% - 2px / 2);left:calc(50% - 28px / 2);-webkit-transition:all 150ms ease-in;transition:all 150ms ease-in;}.meat-1.jsx-3058196896{-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px);transform:translateY(-10px);}.meat-2.jsx-3058196896{width:calc(28px - 6px);}.meat-3.jsx-3058196896{-webkit-transform:translateY(10px);-ms-transform:translateY(10px);transform:translateY(10px);}.active.jsx-3058196896 .meat-1.jsx-3058196896{-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);}.active.jsx-3058196896 .meat-2.jsx-3058196896{opacity:0;}.active.jsx-3058196896 .meat-3.jsx-3058196896{-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg);}@media (min-width:769px){.container.jsx-3058196896{display:none;}}</style><style id="__jsx-4138737674">.container.jsx-4138737674{width:0;}ul.jsx-4138737674{opacity:0;width:100%;height:100vh;text-align:right;list-style:none;margin:0;padding:0;position:fixed;top:0;background-color:#fff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;z-index:1;-webkit-transform:translateY(100%);-ms-transform:translateY(100%);transform:translateY(100%);-webkit-transition:opacity 200ms;transition:opacity 200ms;}.active.jsx-4138737674 ul.jsx-4138737674{opacity:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}li.jsx-4138737674{margin-bottom:1.75rem;font-size:2rem;padding:0 1.5rem 0 0;}li.jsx-4138737674:last-child{margin-bottom:0;}.active.jsx-4138737674{color:#222;}@media (min-width:769px){.container.jsx-4138737674{width:7rem;display:block;}ul.jsx-4138737674{opacity:1;width:7rem;top:auto;display:block;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}li.jsx-4138737674{font-size:1rem;padding:0;}}</style><style id="__jsx-3674465219">span.jsx-3674465219{color:#9b9b9b;}</style><style id="__jsx-255066894">a.jsx-255066894{display:inline-block;}a.jsx-255066894:not(:last-child){margin-right:2em;}</style><style id="__jsx-3618008669">p.jsx-3618008669{font-size:0.75rem;text-align:center;}</style><style id="__jsx-4153080612">.container.jsx-3387257903{display:block;max-width:60rem;width:100%;margin:0 auto;padding:0 1.5rem;box-sizing:border-box;z-index:0;}.metadata.jsx-3387257903 div.jsx-3387257903{display:inline-block;margin-right:0.5rem;}article.jsx-3387257903{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}h1.jsx-3387257903{margin:0 0 0.5rem;font-size:2.25rem;}.tag-list.jsx-3387257903{list-style:none;text-align:right;margin:1.75rem 0 0 0;padding:0;}.tag-list.jsx-3387257903 li.jsx-3387257903{display:inline-block;margin-left:0.5rem;}.social-list.jsx-3387257903{margin-top:3rem;text-align:center;}@media (min-width:769px){.container.jsx-3387257903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><style id="__jsx-1699270818">.token.comment,.token.prolog,.token.doctype,.token.cdata,.token.plain-text{color:#6a737d;}.token.atrule,.token.attr-value,.token.keyword,.token.operator{color:#d73a49;}.token.property,.token.tag,.token.boolean,.token.number,.token.constant,.token.symbol,.token.deleted{color:#22863a;}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#032f62;}.token.function,.token.class-name{color:#6f42c1;}.language-jsx .token.punctuation,.language-jsx .token.tag .token.punctuation,.language-jsx .token.tag .token.script,.language-jsx .token.plain-text{color:#24292e;}.language-jsx .token.tag .token.attr-name{color:#6f42c1;}.language-jsx .token.tag .token.class-name{color:#005cc5;}.language-jsx .token.tag .token.script-punctuation,.language-jsx .token.attr-value .token.punctuation:first-child{color:#d73a49;}.language-jsx .token.attr-value{color:#032f62;}.language-jsx span[class="comment"]{color:pink;}.language-html .token.tag .token.punctuation{color:#24292e;}.language-html .token.tag .token.attr-name{color:#6f42c1;}.language-html .token.tag .token.attr-value,.language-html .token.tag .token.attr-value .token.punctuation:not(:first-child){color:#032f62;}.language-css .token.selector{color:#6f42c1;}.language-css .token.property{color:#005cc5;}</style><style id="__jsx-707554062">.root.jsx-707554062{display:block;padding:4rem 0;box-sizing:border-box;height:100%;}main.jsx-707554062{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width:769px){.root.jsx-707554062{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}main.jsx-707554062{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}}</style></head><body><div id="__next"><div class="jsx-707554062 root"><nav class="jsx-707554062"><div class="jsx-3058196896 container "><div class="jsx-3058196896 meat meat-1"></div><div class="jsx-3058196896 meat meat-2"></div><div class="jsx-3058196896 meat meat-3"></div></div><div class="jsx-4138737674 container "><ul class="jsx-4138737674"><li class="jsx-4138737674"><a class="jsx-4138737674 " href="/">about</a></li><li class="jsx-4138737674"><a class="jsx-4138737674 " href="/projects">projects</a></li><li class="jsx-4138737674"><a class="jsx-4138737674 active" href="/posts">blog</a></li></ul></div></nav><main class="jsx-707554062"><div class="jsx-3387257903 container"><article class="jsx-3387257903"><header class="jsx-3387257903"><h1 class="jsx-3387257903">Search (ada) and Query (gpt-3.5-turbo) Your Codebases Using OpenAI&#x27;s Embeddings and ChatGPT</h1><div class="jsx-3387257903 metadata"><div class="jsx-3387257903"><time dateTime="2023-03-01T00:00:00-08:00" class="jsx-3674465219"><span class="jsx-3674465219">March 1, 2023</span></time></div><div class="jsx-3387257903"><span class="jsx-3674465219">Brad Barrows</span></div></div></header><div class="jsx-3387257903 content_content__1yuPc"><div><div style="position:relative"><span style="position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b">#</span><h1 id="Search%20Any%20Number%20Of%20Files%20Locally%20And%20Chat%20With%20OpenAI%20About%20Them%20%28Code%20Completion%20For%20Your%20Codebase%21%29" class="jsx-2373991563"><a href="#Search%20Any%20Number%20Of%20Files%20Locally%20And%20Chat%20With%20OpenAI%20About%20Them%20%28Code%20Completion%20For%20Your%20Codebase%21%29" class="jsx-2373991563">Search Any Number Of Files Locally And Chat With OpenAI About Them (Code Completion For Your Codebase!)</a></h1></div><p><img src="/static/searchgpt.gif" alt="Running GPT locally on a M1 Macbook"/></p><div style="position:relative"><span style="position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b">#</span><h2 id="Example%20of%20it%20working%20better%20than%20ChatGPT%20alone" class="jsx-2373991563"><a href="#Example%20of%20it%20working%20better%20than%20ChatGPT%20alone" class="jsx-2373991563">Example of it working better than ChatGPT alone</a></h2></div><p>So the ChatCompletion API that openai has is so new that to use it you must build and install the openai-python repo from source.
I was pretty sure ChatGPT wouldn&#x27;t know about this yet and when asking at <a href="https://chat.openai.com/chat">https://chat.openai.com/chat</a> I found I was right:</p><p><img src="/static/chatgpt-completion-ex.png" alt="ChatGPT doesn&#x27;t know about this yet"/></p><p>But when using the tool I have written here, searching through the openai-python codebase (creating embeddings for all python code in this repo and finding the best ones to include in the ChatCompletion/ChatGPT prompt) it works great:</p><p><img src="/static/chatcompletionworks.png" alt="With embeddings we can get information on this"/></p><div style="position:relative"><span style="position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b">#</span><h2 id="Where%20is%20this%3f" class="jsx-2373991563"><a href="#Where%20is%20this%3f" class="jsx-2373991563">Where is this?</a></h2></div><p>The repo is <a href="https://github.com/bebrws/openai-search-codebase-and-chat-about-it">here</a>.</p><div style="position:relative"><span style="position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b">#</span><h2 id="What%20is%20this%3f" class="jsx-2373991563"><a href="#What%20is%20this%3f" class="jsx-2373991563">What is this?</a></h2></div><p>I love ChatGPT. But I really wanted to see if it could be used to search through and provide useful answers about the codebases I work with day to day.
This script is still pretty rough right now but I wanted to push it up in case anyone else has been trying to do this.
I will clean this up when I get time.</p><p>Tree sitter is used to parse through whatever language and then it sends off parts of the AST as embeddings to OpenAI.
Then the embeddings are searched to find the most similar ones to your query using text-embedding-ada-002 and finally the top related code that is found with text-embedding-ada-002 is then used in a prompt to ChatGPT (gpt-3.5-turbo).</p><p>I couldn&#x27;t find any good working examples of this, especially with the language support that I have (tree-sitter will support any language that ChatGPT does).</p><p>Right now it is set to search just through GoLang code. But just change the
<code>current_language </code>
variable to whatever language you want to search/query.</p><p>There is a lot of code I am still refactoring and cleaning up. But it works great! So have fun.</p><div style="position:relative"><span style="position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b">#</span><h2 id="TODO%3a" class="jsx-2373991563"><a href="#TODO%3a" class="jsx-2373991563">TODO:</a></h2></div><ul class="contains-task-list"><li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Combine embeddings of the same node_type that are adjacent to each other</li><li class="task-list-item"><input type="checkbox" disabled=""/> <!-- -->Use num_tokens_from_string to make sure my embeddings/query are the right size</li></ul><div style="position:relative"><span style="position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b">#</span><h2 id="Setup%20tree%20sitter%20parsers" class="jsx-2373991563"><a href="#Setup%20tree%20sitter%20parsers" class="jsx-2373991563">Setup tree sitter parsers</a></h2></div><p>I have included the build folder so you can skip the instructions from <a href="https://github.com/tree-sitter/py-tree-sitter">https://github.com/tree-sitter/py-tree-sitter</a></p><p>But you need to clone the following repos:</p><pre><code>git clone https://github.com/tree-sitter/tree-sitter-go
git clone https://github.com/tree-sitter/tree-sitter-javascript
git clone https://github.com/tree-sitter/tree-sitter-python
</code></pre><p>Then run the following code in python:</p><pre><code>from tree_sitter import Language, Parser

Language.build_library(
    # Store the library in the `build` directory
    &#x27;build/my-languages.so&#x27;,

    # Include one or more languages
    [
        &#x27;tree-sitter-go&#x27;,
        &#x27;tree-sitter-javascript&#x27;,
        &#x27;tree-sitter-python&#x27;
    ]
)
</code></pre><p>to rebuild your own or add new languages.</p><div style="position:relative"><span style="position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b">#</span><h2 id="Install%20required%20packages%2flibraries" class="jsx-2373991563"><a href="#Install%20required%20packages%2flibraries" class="jsx-2373991563">Install required packages/libraries</a></h2></div><pre><code>python3 -m pip install matplotlib
python3 -m pip install plotly
python3 -m pip install scipy
python3 -m pip install sklearn
python3 -m pip install pandas
python3 -m pip install tree_sitter
python3 -m pip install tiktoken
</code></pre><p>And you must install <code>openai-python</code> from the repo so you can use the new ChatCompletion API.</p><div style="position:relative"><span style="position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b">#</span><h2 id="Run%20it" class="jsx-2373991563"><a href="#Run%20it" class="jsx-2373991563">Run it</a></h2></div><pre><code>python3 searchandchat.py
</code></pre></div></div></article><footer class="jsx-3387257903"><div class="jsx-3387257903 social-list"><div class="jsx-255066894"><a title="LinkedIn" href="https://www.linkedin.com/in/bbarrows/}" target="_blank" rel="noopener" class="jsx-255066894"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#222"><path fill="#444" d="M5.453 11.099v15.484H.297V11.099h5.156zm.328-4.781q.016 1.141-.789 1.906t-2.117.766h-.031q-1.281 0-2.063-.766T0 6.318q0-1.156.805-1.914t2.102-.758 2.078.758.797 1.914zM24 17.708v8.875h-5.141v-8.281q0-1.641-.633-2.57t-1.977-.93q-.984 0-1.648.539t-.992 1.336q-.172.469-.172 1.266v8.641H8.296q.031-6.234.031-10.109t-.016-4.625l-.016-.75h5.141v2.25h-.031q.312-.5.641-.875t.883-.812 1.359-.68 1.789-.242q2.672 0 4.297 1.773t1.625 5.195z"></path></svg></a><a title="GitHub" href="https://github.com/bebrws/" target="_blank" rel="noopener" class="jsx-255066894"><svg viewBox="0 0 11 11" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" width="24" height="24" fill="#222"><path d="M10.5 5.63a4.992 4.992 0 01-.977 3.016A5.018 5.018 0 016.998 10.5c-.12.022-.207.007-.263-.047a.267.267 0 01-.083-.2v-1.41c0-.432-.116-.748-.347-.948.253-.027.481-.067.683-.12.203-.054.412-.14.627-.26.216-.121.396-.27.54-.445.145-.176.263-.41.354-.702.091-.291.137-.626.137-1.005a1.95 1.95 0 00-.527-1.376c.164-.405.147-.86-.053-1.363-.125-.04-.305-.015-.54.074a3.59 3.59 0 00-.614.294l-.254.16a4.727 4.727 0 00-1.28-.174c-.44 0-.867.058-1.28.174a5.931 5.931 0 00-.284-.18 3.995 3.995 0 00-.557-.258c-.254-.1-.445-.13-.574-.09-.195.504-.211.958-.046 1.363a1.95 1.95 0 00-.527 1.376c0 .379.045.713.136 1.002.092.29.208.523.35.702.143.178.322.327.537.447.216.12.425.207.627.26.203.054.43.094.684.12-.178.161-.287.39-.327.689a1.32 1.32 0 01-.3.1 1.885 1.885 0 01-.38.034A.785.785 0 013 8.573a1.177 1.177 0 01-.37-.418 1.077 1.077 0 00-.324-.347.973.973 0 00-.33-.16l-.133-.02a.432.432 0 00-.194.03c-.035.02-.046.045-.033.077a.487.487 0 00.147.174l.046.033c.098.044.195.129.29.254.096.124.166.238.21.34l.067.154c.058.17.156.306.294.41.138.105.287.172.447.201.16.029.314.045.463.047a1.96 1.96 0 00.37-.024l.154-.026a62.026 62.026 0 00.007.955c0 .08-.03.147-.087.2-.058.054-.147.07-.267.047a5.018 5.018 0 01-2.524-1.854A4.992 4.992 0 01.255 5.63c0-.93.23-1.789.687-2.575a5.103 5.103 0 011.865-1.867A5.005 5.005 0 015.377.5c.93 0 1.787.23 2.572.688a5.103 5.103 0 011.864 1.867c.458.786.687 1.645.687 2.575z" fill="#444" fill-rule="nonzero"></path></svg></a></div></div><p class="jsx-3618008669">Â© 2021</p></footer></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Search (ada) and Query (gpt-3.5-turbo) Your Codebases Using OpenAI's Embeddings and ChatGPT","dateString":"2023-03-01","slug":"using-embeddings-ada-and-chatgpt-to-search-and-query-a-new-codebase","description":"","tags":["OpenAI","ChatGPT","Whisper","AI","Machine Learning"],"author":"bebrws","source":{"compiledSource":"\"use strict\";\n\nvar _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"Search Any Number Of Files Locally And Chat With OpenAI About Them (Code Completion For Your Codebase!)\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/static/searchgpt.gif\",\n    \"alt\": \"Running GPT locally on a M1 Macbook\"\n  })), mdx(\"h2\", null, \"Example of it working better than ChatGPT alone\"), mdx(\"p\", null, \"So the ChatCompletion API that openai has is so new that to use it you must build and install the openai-python repo from source.\\nI was pretty sure ChatGPT wouldn't know about this yet and when asking at \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://chat.openai.com/chat\"\n  }, \"https://chat.openai.com/chat\"), \" I found I was right:\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/static/chatgpt-completion-ex.png\",\n    \"alt\": \"ChatGPT doesn't know about this yet\"\n  })), mdx(\"p\", null, \"But when using the tool I have written here, searching through the openai-python codebase (creating embeddings for all python code in this repo and finding the best ones to include in the ChatCompletion/ChatGPT prompt) it works great:\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/static/chatcompletionworks.png\",\n    \"alt\": \"With embeddings we can get information on this\"\n  })), mdx(\"h2\", null, \"Where is this?\"), mdx(\"p\", null, \"The repo is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/bebrws/openai-search-codebase-and-chat-about-it\"\n  }, \"here\"), \".\"), mdx(\"h2\", null, \"What is this?\"), mdx(\"p\", null, \"I love ChatGPT. But I really wanted to see if it could be used to search through and provide useful answers about the codebases I work with day to day.\\nThis script is still pretty rough right now but I wanted to push it up in case anyone else has been trying to do this.\\nI will clean this up when I get time.\"), mdx(\"p\", null, \"Tree sitter is used to parse through whatever language and then it sends off parts of the AST as embeddings to OpenAI.\\nThen the embeddings are searched to find the most similar ones to your query using text-embedding-ada-002 and finally the top related code that is found with text-embedding-ada-002 is then used in a prompt to ChatGPT (gpt-3.5-turbo).\"), mdx(\"p\", null, \"I couldn't find any good working examples of this, especially with the language support that I have (tree-sitter will support any language that ChatGPT does).\"), mdx(\"p\", null, \"Right now it is set to search just through GoLang code. But just change the\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"current_language \"), \"\\nvariable to whatever language you want to search/query.\"), mdx(\"p\", null, \"There is a lot of code I am still refactoring and cleaning up. But it works great! So have fun.\"), mdx(\"h2\", null, \"TODO:\"), mdx(\"ul\", {\n    \"className\": \"contains-task-list\"\n  }, mdx(\"li\", {\n    parentName: \"ul\",\n    \"className\": \"task-list-item\"\n  }, mdx(\"input\", {\n    parentName: \"li\",\n    \"type\": \"checkbox\",\n    \"checked\": false,\n    \"disabled\": true\n  }), \" \", \"Combine embeddings of the same node_type that are adjacent to each other\"), mdx(\"li\", {\n    parentName: \"ul\",\n    \"className\": \"task-list-item\"\n  }, mdx(\"input\", {\n    parentName: \"li\",\n    \"type\": \"checkbox\",\n    \"checked\": false,\n    \"disabled\": true\n  }), \" \", \"Use num_tokens_from_string to make sure my embeddings/query are the right size\")), mdx(\"h2\", null, \"Setup tree sitter parsers\"), mdx(\"p\", null, \"I have included the build folder so you can skip the instructions from \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/tree-sitter/py-tree-sitter\"\n  }, \"https://github.com/tree-sitter/py-tree-sitter\")), mdx(\"p\", null, \"But you need to clone the following repos:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"git clone https://github.com/tree-sitter/tree-sitter-go\\ngit clone https://github.com/tree-sitter/tree-sitter-javascript\\ngit clone https://github.com/tree-sitter/tree-sitter-python\\n\")), mdx(\"p\", null, \"Then run the following code in python:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"from tree_sitter import Language, Parser\\n\\nLanguage.build_library(\\n    # Store the library in the `build` directory\\n    'build/my-languages.so',\\n\\n    # Include one or more languages\\n    [\\n        'tree-sitter-go',\\n        'tree-sitter-javascript',\\n        'tree-sitter-python'\\n    ]\\n)\\n\")), mdx(\"p\", null, \"to rebuild your own or add new languages.\"), mdx(\"h2\", null, \"Install required packages/libraries\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"python3 -m pip install matplotlib\\npython3 -m pip install plotly\\npython3 -m pip install scipy\\npython3 -m pip install sklearn\\npython3 -m pip install pandas\\npython3 -m pip install tree_sitter\\npython3 -m pip install tiktoken\\n\")), mdx(\"p\", null, \"And you must install \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"openai-python\"), \" from the repo so you can use the new ChatCompletion API.\"), mdx(\"h2\", null, \"Run it\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"python3 searchandchat.py\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003cdiv style=\"position:relative\"\u003e\u003cspan style=\"position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b\"\u003e#\u003c/span\u003e\u003ch1 id=\"Search%20Any%20Number%20Of%20Files%20Locally%20And%20Chat%20With%20OpenAI%20About%20Them%20%28Code%20Completion%20For%20Your%20Codebase%21%29\" class=\"jsx-2373991563\"\u003e\u003ca href=\"#Search%20Any%20Number%20Of%20Files%20Locally%20And%20Chat%20With%20OpenAI%20About%20Them%20%28Code%20Completion%20For%20Your%20Codebase%21%29\" class=\"jsx-2373991563\"\u003eSearch Any Number Of Files Locally And Chat With OpenAI About Them (Code Completion For Your Codebase!)\u003c/a\u003e\u003c/h1\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"/static/searchgpt.gif\" alt=\"Running GPT locally on a M1 Macbook\"/\u003e\u003c/p\u003e\u003cdiv style=\"position:relative\"\u003e\u003cspan style=\"position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b\"\u003e#\u003c/span\u003e\u003ch2 id=\"Example%20of%20it%20working%20better%20than%20ChatGPT%20alone\" class=\"jsx-2373991563\"\u003e\u003ca href=\"#Example%20of%20it%20working%20better%20than%20ChatGPT%20alone\" class=\"jsx-2373991563\"\u003eExample of it working better than ChatGPT alone\u003c/a\u003e\u003c/h2\u003e\u003c/div\u003e\u003cp\u003eSo the ChatCompletion API that openai has is so new that to use it you must build and install the openai-python repo from source.\nI was pretty sure ChatGPT wouldn\u0026#x27;t know about this yet and when asking at \u003ca href=\"https://chat.openai.com/chat\"\u003ehttps://chat.openai.com/chat\u003c/a\u003e I found I was right:\u003c/p\u003e\u003cp\u003e\u003cimg src=\"/static/chatgpt-completion-ex.png\" alt=\"ChatGPT doesn\u0026#x27;t know about this yet\"/\u003e\u003c/p\u003e\u003cp\u003eBut when using the tool I have written here, searching through the openai-python codebase (creating embeddings for all python code in this repo and finding the best ones to include in the ChatCompletion/ChatGPT prompt) it works great:\u003c/p\u003e\u003cp\u003e\u003cimg src=\"/static/chatcompletionworks.png\" alt=\"With embeddings we can get information on this\"/\u003e\u003c/p\u003e\u003cdiv style=\"position:relative\"\u003e\u003cspan style=\"position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b\"\u003e#\u003c/span\u003e\u003ch2 id=\"Where%20is%20this%3f\" class=\"jsx-2373991563\"\u003e\u003ca href=\"#Where%20is%20this%3f\" class=\"jsx-2373991563\"\u003eWhere is this?\u003c/a\u003e\u003c/h2\u003e\u003c/div\u003e\u003cp\u003eThe repo is \u003ca href=\"https://github.com/bebrws/openai-search-codebase-and-chat-about-it\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\u003cdiv style=\"position:relative\"\u003e\u003cspan style=\"position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b\"\u003e#\u003c/span\u003e\u003ch2 id=\"What%20is%20this%3f\" class=\"jsx-2373991563\"\u003e\u003ca href=\"#What%20is%20this%3f\" class=\"jsx-2373991563\"\u003eWhat is this?\u003c/a\u003e\u003c/h2\u003e\u003c/div\u003e\u003cp\u003eI love ChatGPT. But I really wanted to see if it could be used to search through and provide useful answers about the codebases I work with day to day.\nThis script is still pretty rough right now but I wanted to push it up in case anyone else has been trying to do this.\nI will clean this up when I get time.\u003c/p\u003e\u003cp\u003eTree sitter is used to parse through whatever language and then it sends off parts of the AST as embeddings to OpenAI.\nThen the embeddings are searched to find the most similar ones to your query using text-embedding-ada-002 and finally the top related code that is found with text-embedding-ada-002 is then used in a prompt to ChatGPT (gpt-3.5-turbo).\u003c/p\u003e\u003cp\u003eI couldn\u0026#x27;t find any good working examples of this, especially with the language support that I have (tree-sitter will support any language that ChatGPT does).\u003c/p\u003e\u003cp\u003eRight now it is set to search just through GoLang code. But just change the\n\u003ccode\u003ecurrent_language \u003c/code\u003e\nvariable to whatever language you want to search/query.\u003c/p\u003e\u003cp\u003eThere is a lot of code I am still refactoring and cleaning up. But it works great! So have fun.\u003c/p\u003e\u003cdiv style=\"position:relative\"\u003e\u003cspan style=\"position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b\"\u003e#\u003c/span\u003e\u003ch2 id=\"TODO%3a\" class=\"jsx-2373991563\"\u003e\u003ca href=\"#TODO%3a\" class=\"jsx-2373991563\"\u003eTODO:\u003c/a\u003e\u003c/h2\u003e\u003c/div\u003e\u003cul class=\"contains-task-list\"\u003e\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled=\"\"/\u003e \u003c!-- --\u003eCombine embeddings of the same node_type that are adjacent to each other\u003c/li\u003e\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled=\"\"/\u003e \u003c!-- --\u003eUse num_tokens_from_string to make sure my embeddings/query are the right size\u003c/li\u003e\u003c/ul\u003e\u003cdiv style=\"position:relative\"\u003e\u003cspan style=\"position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b\"\u003e#\u003c/span\u003e\u003ch2 id=\"Setup%20tree%20sitter%20parsers\" class=\"jsx-2373991563\"\u003e\u003ca href=\"#Setup%20tree%20sitter%20parsers\" class=\"jsx-2373991563\"\u003eSetup tree sitter parsers\u003c/a\u003e\u003c/h2\u003e\u003c/div\u003e\u003cp\u003eI have included the build folder so you can skip the instructions from \u003ca href=\"https://github.com/tree-sitter/py-tree-sitter\"\u003ehttps://github.com/tree-sitter/py-tree-sitter\u003c/a\u003e\u003c/p\u003e\u003cp\u003eBut you need to clone the following repos:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003egit clone https://github.com/tree-sitter/tree-sitter-go\ngit clone https://github.com/tree-sitter/tree-sitter-javascript\ngit clone https://github.com/tree-sitter/tree-sitter-python\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThen run the following code in python:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003efrom tree_sitter import Language, Parser\n\nLanguage.build_library(\n    # Store the library in the `build` directory\n    \u0026#x27;build/my-languages.so\u0026#x27;,\n\n    # Include one or more languages\n    [\n        \u0026#x27;tree-sitter-go\u0026#x27;,\n        \u0026#x27;tree-sitter-javascript\u0026#x27;,\n        \u0026#x27;tree-sitter-python\u0026#x27;\n    ]\n)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eto rebuild your own or add new languages.\u003c/p\u003e\u003cdiv style=\"position:relative\"\u003e\u003cspan style=\"position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b\"\u003e#\u003c/span\u003e\u003ch2 id=\"Install%20required%20packages%2flibraries\" class=\"jsx-2373991563\"\u003e\u003ca href=\"#Install%20required%20packages%2flibraries\" class=\"jsx-2373991563\"\u003eInstall required packages/libraries\u003c/a\u003e\u003c/h2\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode\u003epython3 -m pip install matplotlib\npython3 -m pip install plotly\npython3 -m pip install scipy\npython3 -m pip install sklearn\npython3 -m pip install pandas\npython3 -m pip install tree_sitter\npython3 -m pip install tiktoken\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAnd you must install \u003ccode\u003eopenai-python\u003c/code\u003e from the repo so you can use the new ChatCompletion API.\u003c/p\u003e\u003cdiv style=\"position:relative\"\u003e\u003cspan style=\"position:absolute;margin-left:-1.5em;font-weight:300;font-size:1.5rem;color:#9b9b9b\"\u003e#\u003c/span\u003e\u003ch2 id=\"Run%20it\" class=\"jsx-2373991563\"\u003e\u003ca href=\"#Run%20it\" class=\"jsx-2373991563\"\u003eRun it\u003c/a\u003e\u003c/h2\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode\u003epython3 searchandchat.py\n\u003c/code\u003e\u003c/pre\u003e","scope":{"slug":"using-embeddings-ada-and-chatgpt-to-search-and-query-a-new-codebase","title":"Search (ada) and Query (gpt-3.5-turbo) Your Codebases Using OpenAI's Embeddings and ChatGPT","date":"2023-03-01","author":"bebrws","tags":["OpenAI","ChatGPT","Whisper","AI","Machine Learning"]}}},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"using-embeddings-ada-and-chatgpt-to-search-and-query-a-new-codebase"},"buildId":"nENEKRtsitJh7ixPHU9Bl","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>