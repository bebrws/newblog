<!DOCTYPE html><html><head><script type="text/javascript" class="jsx-707554062">
          
          function loadBevySnake() {
            setTimeout(function() {
            var element = document.getElementById('bevy-portal');
                  if (element) {
                    console.log('Element with id "bevy-portal" exists. Adding script tag.');

                  var script = document.createElement('script');
                  script.type = 'module';
                  script.src = '../static/load-bevy-snake.js';
                  document.head.appendChild(script);
            } else {
                    console.log('Element with id "bevy-portal" does not exist.');
                    loadBevySnake();
            }
          }, 500);
        }

        loadBevySnake();
      </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-154810525-2" class="jsx-707554062"></script><script type="text/javascript" class="jsx-707554062">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-154810525-2');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-BZKS5D8HPF" class="jsx-707554062"></script><script type="text/javascript" class="jsx-707554062">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-BZKS5D8HPF');
        </script><meta charSet="utf-8" class="jsx-707554062"/><meta name="viewport" content="width=device-width, initial-scale=1" class="jsx-707554062"/><link rel="manifest" href="/site.webmanifest" class="jsx-707554062"/><link rel="apple-touch-icon" href="/icon.png" class="jsx-707554062"/><meta name="theme-color" content="#fff" class="jsx-707554062"/><title>Scripting Fake UITouch Events Using Frida and Lyft Hammer | Brad Barrows&#x27; Blog</title><meta name="description" content="Brad Barrows&#x27; Blog"/><link rel="canonical" href="https://bbarrows.com/posts/ios-send-fake-simulated-uitouch-events"/><meta property="og:site_name" content="Brad Barrows&#x27; Blog"/><meta property="og:url" content="https://bbarrows.com/posts/ios-send-fake-simulated-uitouch-events"/><meta property="og:title" content="Scripting Fake UITouch Events Using Frida and Lyft Hammer | Brad Barrows&#x27; Blog"/><meta property="og:description" content="Brad Barrows&#x27; Blog"/><meta property="og:image" content="https://bbarrows.com/og_image.png"/><meta property="og:type" content="article"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":"https://bbarrows.com/posts/ios-send-fake-simulated-uitouch-events","headline":"Scripting Fake UITouch Events Using Frida and Lyft Hammer","datePublished":"2023-05-12T00:00:00-07:00","author":"Brad Barrows","description":""}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/8e11f38ccf46f6277e39.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e11f38ccf46f6277e39.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e884486185169a1848b2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e884486185169a1848b2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-f47d69457824065d04c3.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-d32200c037819e7e8fa0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-eae7af63eb651790e0a7.js" defer=""></script><script src="/_next/static/chunks/962-b2e3b32260744832b5cf.js" defer=""></script><script src="/_next/static/chunks/295-d2a92dd57ddb2277243a.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpost%5D-554a7f2db08ad8e20c9d.js" defer=""></script><script src="/_next/static/Vigfb44SD-6keylzdujYt/_buildManifest.js" defer=""></script><script src="/_next/static/Vigfb44SD-6keylzdujYt/_ssgManifest.js" defer=""></script><style id="__jsx-3058196896">.container.jsx-3058196896{position:fixed;width:38px;height:38px;cursor:pointer;top:1rem;left:1.25rem;z-index:2;background-color:rgba(255,255,255,0.7);}.meat.jsx-3058196896{position:absolute;width:28px;height:2px;background:#222;top:calc(50% - 2px / 2);left:calc(50% - 28px / 2);-webkit-transition:all 150ms ease-in;transition:all 150ms ease-in;}.meat-1.jsx-3058196896{-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px);transform:translateY(-10px);}.meat-2.jsx-3058196896{width:calc(28px - 6px);}.meat-3.jsx-3058196896{-webkit-transform:translateY(10px);-ms-transform:translateY(10px);transform:translateY(10px);}.active.jsx-3058196896 .meat-1.jsx-3058196896{-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);}.active.jsx-3058196896 .meat-2.jsx-3058196896{opacity:0;}.active.jsx-3058196896 .meat-3.jsx-3058196896{-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg);}@media (min-width:769px){.container.jsx-3058196896{display:none;}}</style><style id="__jsx-4138737674">.container.jsx-4138737674{width:0;}ul.jsx-4138737674{opacity:0;width:100%;height:100vh;text-align:right;list-style:none;margin:0;padding:0;position:fixed;top:0;background-color:#fff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;z-index:1;-webkit-transform:translateY(100%);-ms-transform:translateY(100%);transform:translateY(100%);-webkit-transition:opacity 200ms;transition:opacity 200ms;}.active.jsx-4138737674 ul.jsx-4138737674{opacity:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}li.jsx-4138737674{margin-bottom:1.75rem;font-size:2rem;padding:0 1.5rem 0 0;}li.jsx-4138737674:last-child{margin-bottom:0;}.active.jsx-4138737674{color:#222;}@media (min-width:769px){.container.jsx-4138737674{width:7rem;display:block;}ul.jsx-4138737674{opacity:1;width:7rem;top:auto;display:block;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}li.jsx-4138737674{font-size:1rem;padding:0;}}</style><style id="__jsx-3674465219">span.jsx-3674465219{color:#9b9b9b;}</style><style id="__jsx-255066894">a.jsx-255066894{display:inline-block;}a.jsx-255066894:not(:last-child){margin-right:2em;}</style><style id="__jsx-3618008669">p.jsx-3618008669{font-size:0.75rem;text-align:center;}</style><style id="__jsx-4153080612">.container.jsx-3387257903{display:block;max-width:60rem;width:100%;margin:0 auto;padding:0 1.5rem;box-sizing:border-box;z-index:0;}.metadata.jsx-3387257903 div.jsx-3387257903{display:inline-block;margin-right:0.5rem;}article.jsx-3387257903{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}h1.jsx-3387257903{margin:0 0 0.5rem;font-size:2.25rem;}.tag-list.jsx-3387257903{list-style:none;text-align:right;margin:1.75rem 0 0 0;padding:0;}.tag-list.jsx-3387257903 li.jsx-3387257903{display:inline-block;margin-left:0.5rem;}.social-list.jsx-3387257903{margin-top:3rem;text-align:center;}@media (min-width:769px){.container.jsx-3387257903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><style id="__jsx-1699270818">.token.comment,.token.prolog,.token.doctype,.token.cdata,.token.plain-text{color:#6a737d;}.token.atrule,.token.attr-value,.token.keyword,.token.operator{color:#d73a49;}.token.property,.token.tag,.token.boolean,.token.number,.token.constant,.token.symbol,.token.deleted{color:#22863a;}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#032f62;}.token.function,.token.class-name{color:#6f42c1;}.language-jsx .token.punctuation,.language-jsx .token.tag .token.punctuation,.language-jsx .token.tag .token.script,.language-jsx .token.plain-text{color:#24292e;}.language-jsx .token.tag .token.attr-name{color:#6f42c1;}.language-jsx .token.tag .token.class-name{color:#005cc5;}.language-jsx .token.tag .token.script-punctuation,.language-jsx .token.attr-value .token.punctuation:first-child{color:#d73a49;}.language-jsx .token.attr-value{color:#032f62;}.language-jsx span[class="comment"]{color:pink;}.language-html .token.tag .token.punctuation{color:#24292e;}.language-html .token.tag .token.attr-name{color:#6f42c1;}.language-html .token.tag .token.attr-value,.language-html .token.tag .token.attr-value .token.punctuation:not(:first-child){color:#032f62;}.language-css .token.selector{color:#6f42c1;}.language-css .token.property{color:#005cc5;}</style><style id="__jsx-707554062">.root.jsx-707554062{display:block;padding:4rem 0;box-sizing:border-box;height:100%;}main.jsx-707554062{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width:769px){.root.jsx-707554062{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}main.jsx-707554062{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}}</style></head><body><div id="__next"><div class="jsx-707554062 root"><nav class="jsx-707554062"><div class="jsx-3058196896 container "><div class="jsx-3058196896 meat meat-1"></div><div class="jsx-3058196896 meat meat-2"></div><div class="jsx-3058196896 meat meat-3"></div></div><div class="jsx-4138737674 container "><ul class="jsx-4138737674"><li class="jsx-4138737674"><a class="jsx-4138737674 " href="/">about</a></li><li class="jsx-4138737674"><a class="jsx-4138737674 " href="/projects">projects</a></li><li class="jsx-4138737674"><a class="jsx-4138737674 active" href="/posts">blog</a></li></ul></div></nav><main class="jsx-707554062"><div class="jsx-3387257903 container"><article class="jsx-3387257903"><header class="jsx-3387257903"><h1 class="jsx-3387257903">Scripting Fake UITouch Events Using Frida and Lyft Hammer</h1><div class="jsx-3387257903 metadata"><div class="jsx-3387257903"><time dateTime="2023-05-12T00:00:00-07:00" class="jsx-3674465219"><span class="jsx-3674465219">May 12, 2023</span></time></div><div class="jsx-3387257903"><span class="jsx-3674465219">Brad Barrows</span></div></div></header><div class="jsx-3387257903 content_content__1yuPc"><div><h1>Simulating or Sending Fake UITouch Events</h1><p>I was having a ton of trouble reverse engineering this Swift app to get it to send a request to lock and unlock my door.</p><p>Long story short, it had some code to refresh the JWT it had in memory that I couldn&#x27;t figure out how to trigger. And the JWT I could find was always old.</p><p>So I had the crazy idea of why not just modify the app so that when it opens, it waits a little bit for the app to load and then sends a fake touch event to the screen to press the button that triggered the request to lock/unlock the door.</p><p>Now there are a number of example&#x27;s of how to do this. One by the great Frida creator himself.</p><p>If you just want a super nice and concise implementation of how this can be done checkout his <a href="https://github.com/nowsecure/frida-uikit">repo here</a></p><p>However, before I found this I had only found Lyft&#x27;s <a href="https://github.com/lyft/Hammer">Hammer repo</a></p><p>Hammer is a little more complicated but has some useful functionality like the ability to wait for the touch event to be handled. So if you wanted to reliably script a chain of touch events you would probably want to use Hammer.</p><p>What ended up being the big issue here for me was the use of the XCTest framework.</p><p>I am pretty sure the XCTest framework is NOT supposed to be EVER deployed to an iOS app on your phone. Just for testing in simulator. Although I am not sure about this.</p><p>What I can say is that it is a dynamically linked library that has a ton of dependencies that your phone won&#x27;t have. So if you do build a dylib from this Hammer repo. Inject the dylib into the app and then try to use it from Frida like I did. You won&#x27;t be able to becuase XCTest has soooo many dependencies.</p><p>XCTest depends on XCTestCore which I think depended on XCTestSupport etc etc... There just a huge tree of dependencies basically coming off of XCTest.</p><p>NOTE: I did try just commenting out all the XCTest related code so I could remove the XCTest dependency. Neutering the wait functionality and this did work. I was able to create a dylib without any required dependencies where I could still send fake touch events.</p><p>I wanted that &quot;wait for touch event to be registered&quot; functionality though and went about trying to get all the dependencies in place.</p><p>This lead me to writing a tool that looks at a dynamically linked library and locates all of its dependencies from your machine, copies them into a folder and updates the rpath so they can find each other.</p><p>Ironically, after I did all this work I found there were some repos out there already doing similar, if not the same thing... Frustrating I didn&#x27;t find this before.</p><p>This is all documented here and I would checkout <a href="https://github.com/bebrws/fixDynamicLibPaths">the README</a> if you are interested in a tool to help get a dependcy tree built when you have a depency like XCTest you want to inject into an iOS app.</p><p>Since Hammer is a Swift app though I had to create a whole Swift project with a bridging header to Objective C so that I could create an Objective C class with class methods I could easily call from Frida. <a href="https://github.com/bebrws/dylibForSendingKeyboardTouchEvents/blob/main/HandleURLScheme/BBEvent.h">This can be found here</a>. Note that is a mess and has left over code form when I was trying to swizzle.</p><p>After injecting the dylib with my wrapper around Hammer and all of its XCTest deps I was able to script touch events using Frida with:</p><pre><code>ObjC.classes[&quot;HandleURLScheme.BBEvent&quot;][&quot;+ sendTouchWindowAtX:y:&quot;](0,0)

</code></pre><p>Note that 0,0 is the center of the screen</p></div></div></article><footer class="jsx-3387257903"><div class="jsx-3387257903 social-list"><div class="jsx-255066894"><a title="LinkedIn" href="https://www.linkedin.com/in/bbarrows/}" target="_blank" rel="noopener" class="jsx-255066894"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#222"><path fill="#444" d="M5.453 11.099v15.484H.297V11.099h5.156zm.328-4.781q.016 1.141-.789 1.906t-2.117.766h-.031q-1.281 0-2.063-.766T0 6.318q0-1.156.805-1.914t2.102-.758 2.078.758.797 1.914zM24 17.708v8.875h-5.141v-8.281q0-1.641-.633-2.57t-1.977-.93q-.984 0-1.648.539t-.992 1.336q-.172.469-.172 1.266v8.641H8.296q.031-6.234.031-10.109t-.016-4.625l-.016-.75h5.141v2.25h-.031q.312-.5.641-.875t.883-.812 1.359-.68 1.789-.242q2.672 0 4.297 1.773t1.625 5.195z"></path></svg></a><a title="GitHub" href="https://github.com/bebrws/" target="_blank" rel="noopener" class="jsx-255066894"><svg viewBox="0 0 11 11" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" width="24" height="24" fill="#222"><path d="M10.5 5.63a4.992 4.992 0 01-.977 3.016A5.018 5.018 0 016.998 10.5c-.12.022-.207.007-.263-.047a.267.267 0 01-.083-.2v-1.41c0-.432-.116-.748-.347-.948.253-.027.481-.067.683-.12.203-.054.412-.14.627-.26.216-.121.396-.27.54-.445.145-.176.263-.41.354-.702.091-.291.137-.626.137-1.005a1.95 1.95 0 00-.527-1.376c.164-.405.147-.86-.053-1.363-.125-.04-.305-.015-.54.074a3.59 3.59 0 00-.614.294l-.254.16a4.727 4.727 0 00-1.28-.174c-.44 0-.867.058-1.28.174a5.931 5.931 0 00-.284-.18 3.995 3.995 0 00-.557-.258c-.254-.1-.445-.13-.574-.09-.195.504-.211.958-.046 1.363a1.95 1.95 0 00-.527 1.376c0 .379.045.713.136 1.002.092.29.208.523.35.702.143.178.322.327.537.447.216.12.425.207.627.26.203.054.43.094.684.12-.178.161-.287.39-.327.689a1.32 1.32 0 01-.3.1 1.885 1.885 0 01-.38.034A.785.785 0 013 8.573a1.177 1.177 0 01-.37-.418 1.077 1.077 0 00-.324-.347.973.973 0 00-.33-.16l-.133-.02a.432.432 0 00-.194.03c-.035.02-.046.045-.033.077a.487.487 0 00.147.174l.046.033c.098.044.195.129.29.254.096.124.166.238.21.34l.067.154c.058.17.156.306.294.41.138.105.287.172.447.201.16.029.314.045.463.047a1.96 1.96 0 00.37-.024l.154-.026a62.026 62.026 0 00.007.955c0 .08-.03.147-.087.2-.058.054-.147.07-.267.047a5.018 5.018 0 01-2.524-1.854A4.992 4.992 0 01.255 5.63c0-.93.23-1.789.687-2.575a5.103 5.103 0 011.865-1.867A5.005 5.005 0 015.377.5c.93 0 1.787.23 2.572.688a5.103 5.103 0 011.864 1.867c.458.786.687 1.645.687 2.575z" fill="#444" fill-rule="nonzero"></path></svg></a></div></div><p class="jsx-3618008669">Â© 2021</p></footer></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Scripting Fake UITouch Events Using Frida and Lyft Hammer","dateString":"2023-05-12","slug":"ios-send-fake-simulated-uitouch-events","description":"","tags":["Reverse engineering","iOS","aws","cognito","frida","lldb","osx","Siri","shortcuts","UITouch","SwiftUI","Deep linking","IOS URLScheme"],"author":"bebrws","source":{"compiledSource":"\"use strict\";\n\nvar _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"Simulating or Sending Fake UITouch Events\"), mdx(\"p\", null, \"I was having a ton of trouble reverse engineering this Swift app to get it to send a request to lock and unlock my door.\"), mdx(\"p\", null, \"Long story short, it had some code to refresh the JWT it had in memory that I couldn't figure out how to trigger. And the JWT I could find was always old.\"), mdx(\"p\", null, \"So I had the crazy idea of why not just modify the app so that when it opens, it waits a little bit for the app to load and then sends a fake touch event to the screen to press the button that triggered the request to lock/unlock the door.\"), mdx(\"p\", null, \"Now there are a number of example's of how to do this. One by the great Frida creator himself.\"), mdx(\"p\", null, \"If you just want a super nice and concise implementation of how this can be done checkout his \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/nowsecure/frida-uikit\"\n  }, \"repo here\")), mdx(\"p\", null, \"However, before I found this I had only found Lyft's \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/lyft/Hammer\"\n  }, \"Hammer repo\")), mdx(\"p\", null, \"Hammer is a little more complicated but has some useful functionality like the ability to wait for the touch event to be handled. So if you wanted to reliably script a chain of touch events you would probably want to use Hammer.\"), mdx(\"p\", null, \"What ended up being the big issue here for me was the use of the XCTest framework.\"), mdx(\"p\", null, \"I am pretty sure the XCTest framework is NOT supposed to be EVER deployed to an iOS app on your phone. Just for testing in simulator. Although I am not sure about this.\"), mdx(\"p\", null, \"What I can say is that it is a dynamically linked library that has a ton of dependencies that your phone won't have. So if you do build a dylib from this Hammer repo. Inject the dylib into the app and then try to use it from Frida like I did. You won't be able to becuase XCTest has soooo many dependencies.\"), mdx(\"p\", null, \"XCTest depends on XCTestCore which I think depended on XCTestSupport etc etc... There just a huge tree of dependencies basically coming off of XCTest.\"), mdx(\"p\", null, \"NOTE: I did try just commenting out all the XCTest related code so I could remove the XCTest dependency. Neutering the wait functionality and this did work. I was able to create a dylib without any required dependencies where I could still send fake touch events.\"), mdx(\"p\", null, \"I wanted that \\\"wait for touch event to be registered\\\" functionality though and went about trying to get all the dependencies in place.\"), mdx(\"p\", null, \"This lead me to writing a tool that looks at a dynamically linked library and locates all of its dependencies from your machine, copies them into a folder and updates the rpath so they can find each other.\"), mdx(\"p\", null, \"Ironically, after I did all this work I found there were some repos out there already doing similar, if not the same thing... Frustrating I didn't find this before.\"), mdx(\"p\", null, \"This is all documented here and I would checkout \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/bebrws/fixDynamicLibPaths\"\n  }, \"the README\"), \" if you are interested in a tool to help get a dependcy tree built when you have a depency like XCTest you want to inject into an iOS app.\"), mdx(\"p\", null, \"Since Hammer is a Swift app though I had to create a whole Swift project with a bridging header to Objective C so that I could create an Objective C class with class methods I could easily call from Frida. \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/bebrws/dylibForSendingKeyboardTouchEvents/blob/main/HandleURLScheme/BBEvent.h\"\n  }, \"This can be found here\"), \". Note that is a mess and has left over code form when I was trying to swizzle.\"), mdx(\"p\", null, \"After injecting the dylib with my wrapper around Hammer and all of its XCTest deps I was able to script touch events using Frida with:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"ObjC.classes[\\\"HandleURLScheme.BBEvent\\\"][\\\"+ sendTouchWindowAtX:y:\\\"](0,0)\\n\\n\")), mdx(\"p\", null, \"Note that 0,0 is the center of the screen\"));\n}\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003ch1\u003eSimulating or Sending Fake UITouch Events\u003c/h1\u003e\u003cp\u003eI was having a ton of trouble reverse engineering this Swift app to get it to send a request to lock and unlock my door.\u003c/p\u003e\u003cp\u003eLong story short, it had some code to refresh the JWT it had in memory that I couldn\u0026#x27;t figure out how to trigger. And the JWT I could find was always old.\u003c/p\u003e\u003cp\u003eSo I had the crazy idea of why not just modify the app so that when it opens, it waits a little bit for the app to load and then sends a fake touch event to the screen to press the button that triggered the request to lock/unlock the door.\u003c/p\u003e\u003cp\u003eNow there are a number of example\u0026#x27;s of how to do this. One by the great Frida creator himself.\u003c/p\u003e\u003cp\u003eIf you just want a super nice and concise implementation of how this can be done checkout his \u003ca href=\"https://github.com/nowsecure/frida-uikit\"\u003erepo here\u003c/a\u003e\u003c/p\u003e\u003cp\u003eHowever, before I found this I had only found Lyft\u0026#x27;s \u003ca href=\"https://github.com/lyft/Hammer\"\u003eHammer repo\u003c/a\u003e\u003c/p\u003e\u003cp\u003eHammer is a little more complicated but has some useful functionality like the ability to wait for the touch event to be handled. So if you wanted to reliably script a chain of touch events you would probably want to use Hammer.\u003c/p\u003e\u003cp\u003eWhat ended up being the big issue here for me was the use of the XCTest framework.\u003c/p\u003e\u003cp\u003eI am pretty sure the XCTest framework is NOT supposed to be EVER deployed to an iOS app on your phone. Just for testing in simulator. Although I am not sure about this.\u003c/p\u003e\u003cp\u003eWhat I can say is that it is a dynamically linked library that has a ton of dependencies that your phone won\u0026#x27;t have. So if you do build a dylib from this Hammer repo. Inject the dylib into the app and then try to use it from Frida like I did. You won\u0026#x27;t be able to becuase XCTest has soooo many dependencies.\u003c/p\u003e\u003cp\u003eXCTest depends on XCTestCore which I think depended on XCTestSupport etc etc... There just a huge tree of dependencies basically coming off of XCTest.\u003c/p\u003e\u003cp\u003eNOTE: I did try just commenting out all the XCTest related code so I could remove the XCTest dependency. Neutering the wait functionality and this did work. I was able to create a dylib without any required dependencies where I could still send fake touch events.\u003c/p\u003e\u003cp\u003eI wanted that \u0026quot;wait for touch event to be registered\u0026quot; functionality though and went about trying to get all the dependencies in place.\u003c/p\u003e\u003cp\u003eThis lead me to writing a tool that looks at a dynamically linked library and locates all of its dependencies from your machine, copies them into a folder and updates the rpath so they can find each other.\u003c/p\u003e\u003cp\u003eIronically, after I did all this work I found there were some repos out there already doing similar, if not the same thing... Frustrating I didn\u0026#x27;t find this before.\u003c/p\u003e\u003cp\u003eThis is all documented here and I would checkout \u003ca href=\"https://github.com/bebrws/fixDynamicLibPaths\"\u003ethe README\u003c/a\u003e if you are interested in a tool to help get a dependcy tree built when you have a depency like XCTest you want to inject into an iOS app.\u003c/p\u003e\u003cp\u003eSince Hammer is a Swift app though I had to create a whole Swift project with a bridging header to Objective C so that I could create an Objective C class with class methods I could easily call from Frida. \u003ca href=\"https://github.com/bebrws/dylibForSendingKeyboardTouchEvents/blob/main/HandleURLScheme/BBEvent.h\"\u003eThis can be found here\u003c/a\u003e. Note that is a mess and has left over code form when I was trying to swizzle.\u003c/p\u003e\u003cp\u003eAfter injecting the dylib with my wrapper around Hammer and all of its XCTest deps I was able to script touch events using Frida with:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eObjC.classes[\u0026quot;HandleURLScheme.BBEvent\u0026quot;][\u0026quot;+ sendTouchWindowAtX:y:\u0026quot;](0,0)\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNote that 0,0 is the center of the screen\u003c/p\u003e","scope":{"slug":"ios-send-fake-simulated-uitouch-events","title":"Scripting Fake UITouch Events Using Frida and Lyft Hammer","date":"2023-05-12","author":"bebrws","tags":["Reverse engineering","iOS","aws","cognito","frida","lldb","osx","Siri","shortcuts","UITouch","SwiftUI","Deep linking","IOS URLScheme"]}}},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"ios-send-fake-simulated-uitouch-events"},"buildId":"Vigfb44SD-6keylzdujYt","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>